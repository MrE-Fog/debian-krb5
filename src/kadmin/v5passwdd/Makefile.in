CFLAGS = $(CCOPTS) $(DEFS) $(LOCALINCLUDE)


COMMON_SRCS = adm_rw.c
COMMON_OBJS = adm_rw.o
SERV_SRCS = main.c srv_net.c proto_serv.c 
SERV_OBJS = main.o srv_net.o proto_serv.o 
CLI_SRCS = kpasswd.c adm_conn.c
CLI_OBJS = kpasswd.o adm_conn.o

SRCS=$(SERV_SRCS) $(COMMON_SRCS) $(CLI_SRCS)
OBJS=$(SERV_OBJS) $(COMMON_OBJS) $(CLI_OBJS)

SERV = v5passwdd
CLI = v5passwd

all:: $(SERV) $(CLI)

$(SERV): $(SERV_OBJS) $(COMMON_OBJS) $(SRVDEPLIBS)
	$(LD) $(LDFLAGS) $(LDARGS) -o $(SERV) $(SERV_OBJS) \
		$(COMMON_OBJS) $(SRVLIBS)


$(CLI): $(CLI_OBJS) $(COMMON_OBJS) $(CLNTDEPLIBS)
	$(LD) $(LDFLAGS) $(LDARGS) -o $(CLI) $(CLI_OBJS) \
		$(COMMON_OBJS) $(CLNTLIBS)

install::
	for f in v5passwd; do \
	  $(INSTALL_PROGRAM) $(C)$$f \
		$(DESTDIR)$(CLIENT_BINDIR)$(S)`echo $$f|sed '$(transform)'`; \
	  $(INSTALL_DATA) $(srcdir)$(S)$$f.M \
		${DESTDIR}$(CLIENT_MANDIR)$(S)`echo $$f|sed '$(transform)'`.1; \
	done
	for f in v5passwdd; do \
	  $(INSTALL_PROGRAM) $(C)$$f \
		$(DESTDIR)$(SERVER_BINDIR)$(S)`echo $$f|sed '$(transform)'`; \
	done

clean::
	$(RM) $(SERV) $(CLI)

