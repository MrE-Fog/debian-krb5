check unit-test:: unit-test-@DO_TEST@

unit-test-:
	@echo "The kpasswd tests require Perl, Tcl, and runtest"
	@echo "No tests run here"

unit-test-ok:: unit-test-setup unit-test-body unit-test-cleanup

unit-test-body::	
	$(ENV_SETUP) $(RUNTEST) --tool kpasswd KPASSWD=../kpasswd \
		KINIT=$(BUILDTOP)/clients/kinit/kinit \
		KDESTROY=$(BUILDTOP)/clients/kdestroy/kdestroy
    
unit-test-setup::
	$(ENV_SETUP) $(START_SERVERS)

unit-test-cleanup::
	$(ENV_SETUP) $(STOP_SERVERS)
