CFLAGS = $(CCOPTS) $(DEFS) $(LOCALINCLUDE)

PROG = kadmin
OBJS = kadmin.o kadmin_ct.o ss_wrapper.o getdate.o keytab.o

all:: $(PROG).local $(PROG)

$(PROG).local: $(OBJS) $(SRVDEPLIBS)
	$(LD) $(LDFLAGS) $(LDARGS) -o $(PROG).local $(OBJS) $(SRVLIBS)

$(PROG): $(OBJS) $(CLNTDEPLIBS)
	$(LD) $(LDFLAGS) $(LDARGS) -o $(PROG) $(OBJS) $(CLNTLIBS)

kadmin_ct.o: kadmin_ct.c

install::
	$(INSTALL_PROGRAM) $(PROG).local ${DESTDIR}$(ADMIN_BINDIR)/$(PROG).local
	$(INSTALL_PROGRAM) $(PROG) ${DESTDIR}$(ADMIN_BINDIR)/$(PROG)
	$(INSTALL_DATA) $(srcdir)/$(PROG).M ${DESTDIR}$(ADMIN_MANDIR)/$(PROG).8
	$(INSTALL_DATA) $(srcdir)/$(PROG).local.M ${DESTDIR}$(ADMIN_MANDIR)/$(PROG).local.8

clean::
	$(RM) $(PROG).local $(PROG) $(OBJS)
clean-unix::
	$(RM) getdate.c kadmin_ct.c

# for testing getdate.y
datetest: getdate.c
	$(CC) -o datetest $(CFLAGS) $(LDFLAGS) $(LDARGS) -DTEST getdate.c
