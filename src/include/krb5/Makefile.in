KDB5DIR = $(KRB5ROOT)
KRB5SRVTABDIR = /etc

KRB5_HEADERS = asn1.h base-defs.h ccache.h crc-32.h encryption.h \
		error_def.h errors.h ext-proto.h fieldbits.h \
		free.h func-proto.h hostaddr.h kdb.h kdb_dbm.h \
		keytab.h krb5.h libos.h los-proto.h macros.h mit-des.h \
		narrow.h proto.h rcache.h rsa-md4.h safepriv.h \
		sysincl.h widen.h wordsize.h
# these are installed here for the build from lib/krb5/error_tables but 
# also need to be in the installed tree
ET_HEADERS = adm_err.h asn1_err.h isode_err.h kdb5_err.h krb5_err.h
BUILT_HEADERS = autoconf.h config.h osconf.h

all:: $(BUILT_HEADERS)

includes:: autoconf.h

# Run a header through a preprocessor to generate an architecture/environment
# specific header file.  note that unifdef's exit status will normally be 1,
# indicating some adjustment of the file took place.

autoconf.h: $(srcdir)/autoconf.h.in config.status
	$(SHELL) config.status

clean::
	$(RM) autoconf.h

depend::

KRB5ROOT = @KRB5ROOT@

KRB5_INCDIR = $(KRB5ROOT)/include

install::
	@set -x; for f in $(KRB5_HEADERS) $(BUILT_HEADERS) $(ET_HEADERS); \
	do $(INSTALL_DATA) $(srcdir)/$$f $(DESTDIR)$(KRB5_INCDIR)/krb5/$$f ; \
	done

PROCESS_REPLACE = -e "s+@KRB5ROOT+$(KRB5ROOT)+" \
		  -e "s+@KDB5DIR+$(KDB5DIR)+" \
		  -e "s+@KRB5SRVTABDIR+${KRB5SRVTABDIR}+" 

OSCONFSRC = $(srcdir)/stock/osconf.h

osconf.h: $(OSCONFSRC)
	cat $(OSCONFSRC) | sed $(PROCESS_REPLACE) > osconf.new
	@if cmp -s osconf.new osconf.h ; then :; \
	else (set -x; $(RM) osconf.h ; $(CP) osconf.new osconf.h) fi

CONF_REPLACE = -e "/UnifdefRan/,/SPLIT-HERE/d"

CONFSRC = $(srcdir)/stock/config.h

config.h: $(CONFSRC)
	cat $(CONFSRC) | sed $(CONF_REPLACE) > config.new
	@if cmp -s config.new config.h ; then :; \
	else (set -x; $(RM) config.h ; $(CP) config.new config.h) fi

clean::
	$(RM) config.new osconf.new $(ET_HEADERS) $(BUILT_HEADERS)
