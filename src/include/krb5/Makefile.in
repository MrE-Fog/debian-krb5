KRB5RCTMPDIR= @KRB5_RCTMPDIR@

##DOSBUILDTOP = ..\..
##DOS!include $(BUILDTOP)\config\windows.in

KRB5_HEADERS = adm.h adm_proto.h asn1.h ext-proto.h k5-config.h k5-errors.h \
		kdb.h kdb_dbm.h libos.h los-proto.h mit-des.h preauth.h \
		rsa-md5.h sysincl.h winsock.h

# these are installed here for the build from lib/krb5/error_tables but 
# also need to be in the installed tree
ET_HEADERS = adm_err.h asn1_err.h kdb5_err.h krb5_err.h
BUILT_HEADERS = autoconf.h osconf.h

all:: all-$(WHAT)

all-unix:: $(BUILT_HEADERS)
all-mac:: $(BUILT_HEADERS)
all-windows:
	copy stock\osconf.h osconf.h
	echo /* not used in windows */ > autoconf.h

includes:: autoconf.h

# Run a header through a preprocessor to generate an architecture/environment
# specific header file.  note that unifdef's exit status will normally be 1,
# indicating some adjustment of the file took place.

autoconf.h: $(srcdir)/autoconf.h.in config.status
	$(SHELL) config.status

clean::
	$(RM) autoconf.h

depend::

install::

PROCESS_REPLACE = -e "s+@KRB5RCTMPDIR+$(KRB5RCTMPDIR)+" \
		  -e "s+@PREFIX+$(INSTALL_PREFIX)+" \
		  -e "s+@EXEC_PREFIX+$(INSTALL_EXEC_PREFIX)+"

OSCONFSRC = $(srcdir)/stock/osconf.h

osconf.h: $(OSCONFSRC)
	cat $(OSCONFSRC) | sed $(PROCESS_REPLACE) > osconf.new
	@if cmp -s osconf.new osconf.h ; then :; \
	else (set -x; $(RM) osconf.h ; $(CP) osconf.new osconf.h; $(RM) osconf.new) fi

clean:: clean-$(WHAT)
	$(RM) osconf.new $(BUILT_HEADERS)

clean-unix::
	$(RM) $(ET_HEADERS)
clean-mac::
clean-windows::
