# makefile: Constructs the Kerberos for Windows ticket manager
# Works for both k4 and k5 releases.
#
NAME 	 = gss
OBJS 	 = gss.obj gss-client.obj gss-misc.obj

##### Options
DEBUG 	 = 1
BUILDTOP =..\..
LIBDIR	 = $(BUILDTOP)\lib
GLIB	 = $(LIBDIR)\gssapi.lib
WLIB	 = $(LIBDIR)\winsock.lib
INCLUDES = /I$(BUILDTOP)\include /I$(BUILDTOP)\include\krb5

##### C Compiler
CC 	 = cl
CFLAGS_RELEASE = /nologo /W3 /AL /GAs /Gy /G2 /Zp /O2 /DNDEBUG=1
CFLAGS_DEBUG   = /nologo /W3 /AL /GAs /Gy /G2 /Zp /O2 /Od /Zi
!if $(DEBUG)
CFLAGS 	 = $(CFLAGS_DEBUG) $(INCLUDES)
!else
CFLAGS 	 = $(CFLAGS_RELEASE) $(INCLUDES)
!endif

##### RC Compiler
RC 	 = rc
##WIN16##RFLAGS 	 = /nologo $(INCLUDES)
##WIN32##RFLAGS 	 = $(INCLUDES)

##### Linker
LINK 	 = link
LIBS 	 = $(GLIB) $(WLIB)
SYSLIBS  = libw llibcew
!if $(DEBUG)
LFLAGS 	 = /co /nologo /nod /nopackcode /map:full
!else
LFLAGS 	 = /nologo /nod /nopackcode
!endif

all:: makefile $(NAME).exe

$(NAME).exe: $*.def $*.res $(OBJS) $(LIBS)
	$(LINK) $(LFLAGS) $(OBJS), $@, $*.map, $(LIBS) $(SYSLIBS), $*.def
	$(RC) $(RFLAGS) /k $*.res $@

$(OBJS) $(NAME).res: gss.h

install:
	copy gss.exe ..\floppy

clean:: 
	if exist *.exe del *.exe
	if exist ..\floppy\gss.exe del ..\floppy\gss.exe
	if exist *.obj del *.obj
	if exist *.res del *.res
	if exist *.map del *.map
	if exist *.pdb del *.pdb
	if exist *.err del *.err

