CFLAGS = $(CCOPTS) $(DEFS) $(LOCALINCLUDE)
LDFLAGS = -g

COMERRLIB=$(BUILDTOP)/util/et/libcom_err.a
SSLIB=$(BUILDTOP)/util/ss/libss.a
KDBLIB=-lkdb5 
DEPKDBLIB=$(TOPLIBD)/libkdb5.a 
KADMLIB=-lkadm
DEPKADMLIB=$(TOPLIBD)/libkadm.a

all::

KLIB = $(KADMLIB) -lkrb5 -lcrypto $(SSLIB) $(COMERRLIB)
DEPKLIB = $(DEPKADMLIB) $(TOPLIBD)/libkrb5.a $(TOPLIBD)/libcrypto.a $(SSLIB) $(COMERRLIB)

DEPLIBS = $(DEPKDBLIB) $(DEPKLIB)
LOCAL_LIBRARIES = $(KDBLIB) $(KLIB)


SRCS = \
	$(srcdir)/adm_server.c \
	$(srcdir)/adm_parse.c \
	$(srcdir)/adm_network.c \
	$(srcdir)/adm_listen.c \
	$(srcdir)/adm_process.c \
	$(srcdir)/adm_nego.c \
	$(srcdir)/adm_kpasswd.c \
	$(srcdir)/adm_kadmin.c \
	$(srcdir)/adm_fmt_inq.c \
	$(srcdir)/adm_adm_func.c \
	$(srcdir)/adm_funcs.c \
	$(srcdir)/adm_check.c \
	$(srcdir)/adm_extern.c \
	$(srcdir)/adm_msgs.c

OBJS = \
	adm_server.o \
	adm_parse.o \
	adm_network.o \
	adm_listen.o \
	adm_process.o \
	adm_nego.o \
	adm_kpasswd.o \
	adm_kadmin.o \
	adm_fmt_inq.o \
	adm_adm_func.o \
	adm_funcs.o \
	adm_check.o \
	adm_extern.o \
	adm_msgs.o

all::	kadmind

kadmind: $(KDBDEPLIB) $(OBJS) $(DEPLIBS)
	$(LD) $(LDFLAGS) $(LDARGS) -o kadmind $(OBJS) $(KDBLIB) $(KLIB) $(LIBS)

install::
	$(INSTALL_PROGRAM) $(C)kadmind ${DESTDIR}$(SERVER_BINDIR)$(S)kadmind_old
	$(INSTALL_DATA) $(srcdir)$(S)kadmind.M ${DESTDIR}$(SERVER_MANDIR)$(S)kadmind_old.8

clean::
	$(RM) kadmind

