AC_INIT(configure.in)
WITH_CCOPTS
CONFIG_RULES
AC_SET_BUILDTOP
WITH_NETLIB
AC_PROG_ARCHIVE
AC_PROG_ARCHIVE_ADD
AC_PROG_RANLIB
AC_CHECK_SIZEOF(short)
AC_CHECK_SIZEOF(int)
AC_CHECK_SIZEOF(long)

dnl Determine the size of datum and DBT size fields. If they are not the same
dnl then the elements need to be copied.
AC_MSG_CHECKING(size of datum.dsize)
AC_CACHE_VAL(ac_cv_sizeof_datum_dsize,
[AC_TRY_RUN([#include <stdio.h>
#include <ndbm.h>
main()
{
  FILE *f=fopen("conftestval", "w");
  datum k;
  if (!f) exit(1);
  fprintf(f, "%d\n", sizeof(k.dsize));
  exit(0);
}], ac_cv_sizeof_datum_dsize=`cat conftestval`)])dnl
AC_MSG_RESULT($ac_cv_sizeof_datum_dsize)
AC_DEFINE_UNQUOTED(SIZEOF_DATUM_DSIZE, $ac_cv_sizeof_datum_dsize)

AC_MSG_CHECKING(size of DBT.size)
AC_CACHE_VAL(ac_cv_sizeof_dbt_size,
[AC_TRY_RUN([#include <stdio.h>
#include <sys/types.h>
typedef struct {
	void	*data;			/* data */
	size_t	 size;			/* data length */
} DBT;
main()
{
  FILE *f=fopen("conftestval", "w");
  DBT k;
  if (!f) exit(1);
  fprintf(f, "%d\n", sizeof(k.size));
  exit(0);
}], ac_cv_sizeof_dbt_size=`cat conftestval`)])dnl
AC_MSG_RESULT($ac_cv_sizeof_dbt_size)
AC_DEFINE_UNQUOTED(SIZEOF_DBT_SIZE, $ac_cv_sizeof_dbt_size)

AC_HAVE_FUNCS(mktemp mkstemp)
CHECK_SIGNALS
SubdirLibraryRule([$(OBJS)])
KRB_INCLUDE
V5_AC_OUTPUT_MAKEFILE
