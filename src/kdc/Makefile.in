BUILDTOP=@BUILDTOP@
srcdir = @srcdir@
VPATH = @srcdir@
 
DEFS = @DEFS@
CC = @CC@
CCOPTS = @CCOPTS@
LIBS = @LIBS@
KRB4 = @KRB4@
K4LIB = @K4LIB@
KRB5ROOT = @KRB5ROOT@

CFLAGS = $(CCOPTS) $(DEFS) $(LOCALINCLUDE)
LDFLAGS = -g

KRB5MANROOT = $(KRB5ROOT)/man
ADMIN_BINDIR = $(KRB5ROOT)/admin
SERVER_BINDIR = $(KRB5ROOT)/sbin
CLIENT_BINDIR = $(KRB5ROOT)/bin
ADMIN_MANDIR = $(KRB5MANROOT)/man8
SERVER_MANDIR = $(KRB5MANROOT)/man8
CLIENT_MANDIR = $(KRB5MANROOT)/man1
FILE_MANDIR = $(KRB5MANROOT)/man5
KRB5_LIBDIR = $(KRB5ROOT)/lib
KRB5_INCDIR = $(KRB5ROOT)/include
KRB5_INCSUBDIRS = \
	$(KRB5_INCDIR)/krb5 \
	$(KRB5_INCDIR)/asn.1 \
	$(KRB5_INCDIR)/kerberosIV

SRCTOP = $(srcdir)/$(BUILDTOP)
TOPLIBD = $(BUILDTOP)/lib
ISODELIB=@ISODELIB@
COMERRLIB=$(BUILDTOP)/util/et/libcom_err.a
DBMLIB=
KDBLIB=$(TOPLIBD)/libkdb5.a 

RM = rm -f
CP = cp

AWK = @AWK@

KLIB = $(TOPLIBD)/libkrb5.a $(TOPLIBD)/libcrypto.a $(ISODELIB) $(COMERRLIB) $(DBMLIB)

KRB4INCLUDES=-I$(SRCTOP)/include/kerberosIV

all::

DEFINES = -DBACKWARD_COMPAT $(KRB4DEF)

LOCALINCLUDE = $(KRB4INCLUDES) -I.
SRCS= \
	kdc5_err.c \
	$(srcdir)/dispatch.c \
	$(srcdir)/do_as_req.c \
	$(srcdir)/do_tgs_req.c \
	$(srcdir)/kdc_util.c \
	$(srcdir)/main.c \
	$(srcdir)/network.c \
	$(srcdir)/policy.c \
	$(srcdir)/extern.c \
	$(srcdir)/replay.c \
	$(srcdir)/kerberos_v4.c

OBJS= \
	kdc5_err.o \
 	dispatch.o \
	do_as_req.o \
	do_tgs_req.o \
	kdc_util.o \
	main.o \
	network.o \
	policy.o \
	extern.o \
	replay.o \
	kerberos_v4.o

all::	krb5kdc

depend:: kdc5_err.c

kdc5_err.c: kdc5_err.et

kdc5_err.h: kdc5_err.et

kdc5_err.o: kdc5_err.h

krb5kdc: $(OBJS) $(KDBDEPLIB) $(DEPKLIB)
	$(CC) $(CFLAGS) -o krb5kdc $(OBJS) $(KDBLIB) $(KLIB) $(K4LIB) $(LIBS)

install::
	cp krb5kdc ${DESTDIR}$(SERVER_BINDIR)/krb5kdc
	cp krb5kdc.M ${DESTDIR}$(SERVER_MANDIR)/krb5kdc.8

clean::
	$(RM) kdc5_err.h kdc5_err.c

clean::
	$(RM) $(OBJS)

