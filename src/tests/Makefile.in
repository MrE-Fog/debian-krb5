CFLAGS = $(CCOPTS)
LDFLAGS = -g

TEST_DB = ./testdb
TEST_REALM = FOO.TEST.REALM
TEST_MKEY = footes
TEST_NUM = 100
TEST_PREFIX = "foo bar"

KADMIN_OPTS= -d $(TEST_DB) -r $(TEST_REALM) -P $(TEST_MKEY)
KTEST_OPTS= $(KADMIN_OPTS) -p $(TEST_PREFIX) -n $(TEST_NUM)

check:: kdb_check

kdb_check:
	$(RM) $(TEST_DB)*
	../admin/create/kdb5_create $(KADMIN_OPTS)
	../tests/create/kdb5_mkdums $(KTEST_OPTS) 
	../tests/verify/kdb5_verify $(KTEST_OPTS) 
	../admin/edit/kdb5_edit $(KADMIN_OPTS) -R "dump_db $(TEST_DB).dump"
	../admin/destroy/kdb5_destroy -d $(TEST_DB) -f
	../admin/edit/kdb5_edit -r $(TEST_REALM) -R "load_db $(TEST_DB).dump $(TEST_DB)"
	../tests/verify/kdb5_verify $(KTEST_OPTS) 
	../admin/edit/kdb5_edit $(KADMIN_OPTS) -R "dump_db $(TEST_DB).dump2"
	sort $(TEST_DB).dump > $(TEST_DB).sort
	sort $(TEST_DB).dump2 > $(TEST_DB).sort2
	cmp $(TEST_DB).sort $(TEST_DB).sort2
	../admin/destroy/kdb5_destroy -d $(TEST_DB) -f
	$(RM) $(TEST_DB)*


