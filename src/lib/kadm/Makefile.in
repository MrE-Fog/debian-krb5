CFLAGS = $(CCOPTS) $(DEFS) 
LDFLAGS = -g

##DOSBUILDTOP = ..\..
##DOSLIBNAME=kadm.lib
##DOS!include $(BUILDTOP)\config\windows.in

OBJS=	adm_conn.$(OBJEXT)	\
	adm_kw_dec.$(OBJEXT)	\
	adm_kw_enc.$(OBJEXT)	\
	adm_kt_dec.$(OBJEXT)	\
	adm_kt_enc.$(OBJEXT)	\
	adm_rw.$(OBJEXT)

SRCS=	$(srcdir)/adm_conn.c	\
	$(srcdir)/adm_kw_dec.c	\
	$(srcdir)/adm_kw_enc.c	\
	$(srcdir)/adm_kt_dec.c	\
	$(srcdir)/adm_kt_enc.c	\
	$(srcdir)/adm_rw.c

all:: $(OBJS)

libkadm.a: $(OBJS)
	$(RM) $@
	$(ARADD) $@ $(OBJS)
	$(RANLIB) $@
	$(RM) $(TOPLIBD)/libkadm.a
	$(CP) libkadm.a $(BUILDTOP)/lib/libkadm.a
	$(RANLIB) $(BUILDTOP)/lib/libkadm.a

install:: libkadm.a
	$(INSTALL_DATA) libkadm.a $(DESTDIR)$(KRB5_LIBDIR)/libkadm.a
	$(RANLIB) $(DESTDIR)$(KRB5_LIBDIR)/libkadm.a

clean::
	$(RM) libkadm.$(LIBEXT)

#
# t_dbentry
#
T_DBENTRY_OBJS =  t_dbentry.$(OBJEXT) \
		$(TOPLIBD)/libkadm.a $(TOPLIBD)/libkrb5.a	\
		$(TOPLIBD)/libcrypto.a $(BUILDTOP)/util/et/libcom_err.a

t_dbentry:	$(T_DBENTRY_OBJS)
	$(LD) -o t_dbentry $(T_DBENTRY_OBJS) $(LIBS)

#
# t_ktentry
#
T_KTENTRY_OBJS =  t_ktentry.$(OBJEXT) \
		$(TOPLIBD)/libkadm.a $(TOPLIBD)/libkrb5.a	\
		$(TOPLIBD)/libcrypto.a $(BUILDTOP)/util/et/libcom_err.a

t_ktentry:	$(T_KTENTRY_OBJS)
	$(LD) -o t_ktentry $(T_KTENTRY_OBJS) $(LIBS)

TEST_PROGS	= t_dbentry t_ktentry

check::	check-$(WHAT)

check-unix::	$(TEST_PROGS)
	./t_dbentry -r 100
	./t_ktentry -r 100

check-mac::

check-windows::

clean::
	$(RM) t_dbentry$(EXEEXT) t_dbentry.$(OBJEXT)
	$(RM) t_ktentry$(EXEEXT) t_ktentry.$(OBJEXT)

