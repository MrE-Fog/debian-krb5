CFLAGS = $(CCOPTS) $(DEFS)
KRB5_RUN_ENV = @KRB5_RUN_ENV@

KRB5_VER=@KRB5_SH_VERS@
CRYPTO_VER=@CRYPTO_SH_VERS@
DEPLIBS=$(TOPLIBD)/libkrb5.$(SHEXT).$(KRB5_VER) \
	$(TOPLIBD)/libcrypto.$(SHEXT).$(CRYPTO_VER)

SHLIB_LIBS=$(LIBS)
SHLIB_LDFLAGS= $(LDFLAGS) @SHLIB_RPATH_DIRS@ 
SHLIB_LIBDIRS= @SHLIB_LIBDIRS@



all:: $(OBJS)

.c.o:
	$(CC) $(CFLAGS) -c $(srcdir)/$*.c
@SHARED_RULE@

SRCS= \
	$(srcdir)/keytab.c \
	$(srcdir)/encrypt_key.c \
	$(srcdir)/decrypt_key.c \
	$(srcdir)/kdb_cpw.c \
	$(srcdir)/kdb_dbm.c \
	$(srcdir)/kdb_xdr.c \
	$(srcdir)/verify_mky.c \
	$(srcdir)/fetch_mkey.c \
	$(srcdir)/setup_mkey.c \
	$(srcdir)/store_mkey.c

OBJS= \
	keytab.o \
	encrypt_key.o \
	decrypt_key.o \
	kdb_cpw.o \
	kdb_dbm.o \
	kdb_xdr.o \
	verify_mky.o \
	fetch_mkey.o \
	setup_mkey.o \
	store_mkey.o

LIB_SUBDIRS= .
LIBDONE = DONE

all-unix:: shared

shared:
	mkdir shared

clean-unix::
	$(RM) shared/*
	-rmdir shared

DONE: $(OBJS)
	$(RM) DONE
	echo $(OBJS) > DONE

libkdb5.$(STEXT): $(OBJS)
	$(RM) $@
	$(ARADD) $@ $(OBJS)
	$(RANLIB) $@


clean::
	$(RM) libkdb5.a DONE

t_kdb:	t_kdb.o $(OBJS) $(TOPLIBD)/libkrb5.a $(TOPLIBD)/libcrypto.a $(TOPLIBD)/libcom_err.a $(TOPLIBD)/libdb.a
	$(LD) $(LDFLAGS) $(LDARGS) -o t_kdb t_kdb.o $(OBJS) $(LIBS) -ldb

check::	t_kdb
	$(KRB5_RUN_ENV) ./t_kdb -tcv
	$(KRB5_RUN_ENV) ./t_kdb -tcvr

clean::
	$(RM) t_kdb t_kdb.o

