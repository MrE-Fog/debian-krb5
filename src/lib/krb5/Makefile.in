##DOSBUILDTOP = ..\..
##DOS!include $(BUILDTOP)\config\windows.in

TST=if test -n "`cat DONE`" ; then

LIB_SUBDIRS= error_tables asn.1 ccache ccache/stdio ccache/file \
	keytab keytab/file krb rcache free os posix
LIBUPDATE= $(BUILDTOP)/util/libupdate

all:: all-$(WHAT)

all-unix::

all-windows::

libkrb5_ranlib: libkrb5.a
	$(RANLIB) libkrb5.a
	touch $@

libkrb5.a: error_tables/DONE asn.1/DONE ccache/DONE ccache/stdio/DONE \
		ccache/file/DONE keytab/DONE keytab/file/DONE krb/DONE \
		rcache/DONE free/DONE os/DONE posix/DONE
	if test -f $@ ; then \
		for i in $(LIB_SUBDIRS) ; \
		do \
			$(LIBUPDATE) $@ $$i/DONE $$i ; \
		done ; \
	else \
		for i in $(LIB_SUBDIRS) ; \
		do \
			$(LIBUPDATE) --force $@ $$i/DONE $$i ; \
		done ; \
	fi
	touch libkrb5.stamp

install:: libkrb5_ranlib
	$(INSTALL_DATA) libkrb5.a $(DESTDIR)$(KRB5_LIBDIR)/libkrb5.a
	$(RANLIB) $(DESTDIR)$(KRB5_LIBDIR)/libkrb5.a

clean:: clean-$(WHAT)

clean-unix::
	$(RM) libkrb5.$(LIBEXT) libkrb5_ranlib libkrb5.stamp

clean-windows::
	$(RM) krb5.lib krb5.bak

all-windows::
	cd ASN.1
	@echo Making in lib\asn.1
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\CCACHE
	@echo Making in lib\ccache
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\ERROR_TA
	@echo Making in lib\error_ta
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\FREE
	@echo Making in lib\free
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\KEYTAB
	@echo Making in lib\keytab
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\KRB
	@echo Making in lib\krb
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\OS
	@echo Making in lib\os
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\POSIX
	@echo Making in lib\posix
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\RCACHE
	@echo Making in lib\rcache
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..

clean-windows::
	cd ASN.1
	@echo Making clean in lib\asn.1
	-$(MAKE) -$(MFLAGS) clean
	cd ..\CCACHE
	@echo Making clean in lib\ccache
	-$(MAKE) -$(MFLAGS) clean
	cd ..\ERROR_TA
	@echo Making clean in lib\error_ta
	-$(MAKE) -$(MFLAGS) clean
	cd ..\FREE
	@echo Making clean in lib\free
	-$(MAKE) -$(MFLAGS) clean
	cd ..\KEYTAB
	@echo Making clean in lib\keytab
	-$(MAKE) -$(MFLAGS) clean
	cd ..\KRB
	@echo Making clean in lib\krb
	-$(MAKE) -$(MFLAGS) clean
	cd ..\OS
	@echo Making clean in lib\os
	-$(MAKE) -$(MFLAGS) clean
	cd ..\POSIX
	@echo Making clean in lib\posix
	-$(MAKE) -$(MFLAGS) clean
	cd ..\RCACHE
	@echo Making clean in lib\rcache
	-$(MAKE) -$(MFLAGS) clean
	cd ..
	@echo Making clean locally

