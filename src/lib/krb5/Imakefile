#	$Source$
#	$Author$
#	$Id$
#
#  Copyright 1990,1991 by the Massachusetts Institute of Technology.
#  All Rights Reserved.
# 
# Export of this software from the United States of America is assumed
#   to require a specific license from the United States Government.
#   It is the responsibility of any person or organization contemplating
#   export to obtain such a license before exporting.
# 
# WITHIN THAT CONSTRAINT, permission to use, copy, modify, and
# distribute this software and its documentation for any purpose and
# without fee is hereby granted, provided that the above copyright
# notice appear in all copies and that both that copyright notice and
# this permission notice appear in supporting documentation, and that
# the name of M.I.T. not be used in advertising or publicity pertaining
# to distribution of the software without specific, written prior
# permission.  M.I.T. makes no representations about the suitability of
# this software for any purpose.  It is provided "as is" without express
# or implied warranty.
# 
# 
#define IHaveSubdirs
#define PassCDebugFlags
NormalLibraryObjectRule()

SUBDIRS1 = error_tables
SUBDIRS2 = ccache keytab krb rcache free os kdb des \
	des425 crc32 krb425 md4 md5 gssapi
SUBDIRS = $(SUBDIRS1) asn.1 $(SUBDIRS2)

#ifdef HasVfprintf
VPOBJS=
VPSRCS=
#else
VPOBJS=vfprintf.o vsprintf.o
VPSRCS=$(SRCDIR)vfprintf.c $(SRCDIR)vsprintf.c
#endif
#ifdef HasVsyslog
VSOBJS=
VSSRCS=
#else
VSOBJS=syslog.o
VSSRCS=$(SRCDIR)syslog.c
#endif
#ifdef HasStrdup
STOBJS=
STSRCS=
#else
STOBJS=strdup.o
STSRCS=$(SRCDIR)strdup.c
#endif
#ifndef HasStrerror
PEOBJS=perror.o
PESRCS=$(SRCDIR)perror.c
#endif

INCLUDES=$(STDC_TOP_INCLUDES)

OBJS =	\
	cryptoconf.o \
	$(PEOBJS) $(VSOBJS) $(VPOBJS) $(STOBJS)

SRCS =	\
	$(SRCDIR)cryptoconf.c \
	$(PESRCS) $(VSSRCS) $(VPSRCS) $(STSRCS)

MakeSubdirs($(SUBDIRS))

#ifdef UseSedHack

/* Imake using System V derived cpp generates a bad Makefile.  */

/* This target will make all Makefiles except asn.1/Makefile. */
#undef MakefileSubdirs
#define MakefileSubdirs(dirs)						@@\
MakeMakeSubdirs($(SUBDIRS1) $(SUBDIRS2), Makefiles)

#ifdef SourceTop
     IMAKEARG = -f/**/SourceTop/CURDIR/asn.1/Imakefile
#endif

Makefiles:: asn.1/Makefile

asn.1/Makefile::
	@case '${MFLAGS}' in *[ik]*) set +e;; esac; \
	case '${MFLAGS}' in *n*) executeit="no";; esac; \
	case $(TOP) in \
	/?*) imaketop=$(TOP) ; top=$(TOP) ;; \
	*) imaketop=../ ; top=../$(TOP) ;; \
	esac; \
	echo "making asn.1/Makefile..."; \
	i=asn.1 ; \
	cd $$i; \
	$(RM) Makefile.bak; \
	if [ -f Makefile ]; then \
		echo "	$(MV) Makefile Makefile.bak"; \
		if [ "$$executeit" != "no" ]; then \
			$(MV) Makefile Makefile.bak; \
		fi; \
	fi; \
	if [ "$$executeit" != "no" ]; then \
		curdir=$(CURRENT_DIR)/; \
		ImakeSubCmdHelper -DTOPDIR=$$top -DCURDIR=CURDIR/$$i -f$(SRCSUBDIR)Imakefile -s Makefile.new; \
		sed 's/^@/	@/' Makefile.new > Makefile.newer && $(MV) Makefile.newer Makefile.new ; \
		$(MAKE) -f Makefile.new noop; \
		if [ -f Makefile ]; then \
			$(RM) Makefile.bak; $(MV) Makefile Makefile.bak; \
		fi ; \
		$(MV) Makefile.new Makefile; \
		$(RM) Makefile.new Makefile.newer; \
	fi

#endif	/* UseSedHack */

AdditiveLibraryTarget(krb5,$(OBJS),-L$(KRB5_LIBDIR) -Lshared $(LDLOCATIONS) -l$(DESLIB) $(ISODELIB) -lcom_err)

RanlibLibraryTarget($(DESLIB),)

Krb5InstallLibrary(krb5,$(KRB5_LIBDIR))
Krb5InstallLibrary($(DESLIB),$(KRB5_LIBDIR))

SharedLibraryTarget(kdb5,-L$(KRB5_LIBDIR) -Lshared $(LDLOCATIONS) -lkrb5 -l$(DESLIB) $(ISODELIB) -lcom_err)
/* SharedLibraryTarget(des425,-L$(KRB5_LIBDIR) -Lshared $(LDLOCATIONS) -l$(DESLIB)) */
