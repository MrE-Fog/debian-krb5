#	$Source$
#	$Author$
#	$Id$
#
#  Copyright 1990,1991 by the Massachusetts Institute of Technology.
#  All Rights Reserved.
# 
# Export of this software from the United States of America may
#   require a specific license from the United States Government.
#   It is the responsibility of any person or organization contemplating
#   export to obtain such a license before exporting.
# 
# WITHIN THAT CONSTRAINT, permission to use, copy, modify, and
# distribute this software and its documentation for any purpose and
# without fee is hereby granted, provided that the above copyright
# notice appear in all copies and that both that copyright notice and
# this permission notice appear in supporting documentation, and that
# the name of M.I.T. not be used in advertising or publicity pertaining
# to distribution of the software without specific, written prior
# permission.  M.I.T. makes no representations about the suitability of
# this software for any purpose.  It is provided "as is" without express
# or implied warranty.
# 
# 
#define IHaveSubdirs
#define PassCDebugFlags

SUBDIRS1 = error_tables
SUBDIRS2 = ccache keytab krb rcache free os posix
SUBDIRS = $(SUBDIRS1) asn.1 $(SUBDIRS2)

MakeSubdirs($(SUBDIRS))

#ifdef UseSedHack

/* Imake using System V derived cpp generates a bad Makefile.  */

/* This target will make all Makefiles except asn.1/Makefile. */
#undef MakefileSubdirs
#define MakefileSubdirs(dirs)						@@\
MakeMakeSubdirs($(SUBDIRS1) $(SUBDIRS2), Makefiles)

#ifdef SourceTop
     IMAKEARG = -f/**/SourceTop/CURDIR/asn.1/Imakefile
#endif

Makefiles:: asn.1/Makefile

asn.1/Makefile::
	@case '${MFLAGS}' in *[ik]*) set +e;; esac; \
	case '${MFLAGS}' in *n*) executeit="no";; esac; \
	case $(TOP) in \
	/?*) imaketop=$(TOP) ; top=$(TOP) ;; \
	*) imaketop=../ ; top=../$(TOP) ;; \
	esac; \
	echo "making asn.1/Makefile..."; \
	i=asn.1 ; \
	cd $$i; \
	$(RM) Makefile.bak; \
	if [ -f Makefile ]; then \
		echo "	$(MV) Makefile Makefile.bak"; \
		if [ "$$executeit" != "no" ]; then \
			$(MV) Makefile Makefile.bak; \
		fi; \
	fi; \
	if [ "$$executeit" != "no" ]; then \
		curdir=$(CURRENT_DIR)/; \
		$(IMAKE_CMD) -DTOPDIR=$$top -DCURDIR=CURDIR/$$i -f$(SRCSUBDIR)Imakefile -s Makefile.new; \
		sed 's/^@/	@/' Makefile.new > Makefile.newer && $(MV) Makefile.newer Makefile.new ; \
		$(MAKE) -f Makefile.new noop; \
		if [ -f Makefile ]; then \
			$(RM) Makefile.bak; $(MV) Makefile Makefile.bak; \
		fi ; \
		$(MV) Makefile.new Makefile; \
		$(RM) Makefile.new Makefile.newer; \
	fi

#endif	/* UseSedHack */

libkrb5.a: error_tables/DONE asn.1/DONE ccache/DONE ccache/stdio/DONE \
		ccache/file/DONE keytab/DONE keytab/file/DONE krb/DONE \
		rcache/DONE free/DONE os/DONE posix/DONE
	(cd error_tables; $(ARADD) ../$@ `cat DONE`)
	(cd asn.1; $(ARADD) ../$@ `cat DONE`)
	(cd ccache; $(ARADD) ../$@ `cat DONE`)
	(cd ccache/stdio; $(ARADD) ../../$@ `cat DONE`)
	(cd ccache/file; $(ARADD) ../../$@ `cat DONE`)
	(cd keytab; $(ARADD) ../$@ `cat DONE`)
	(cd keytab/file; $(ARADD) ../../$@ `cat DONE`)
	(cd krb; $(ARADD) ../$@ `cat DONE`)
	(cd rcache; $(ARADD) ../$@ `cat DONE`)
	(cd free; $(ARADD) ../$@ `cat DONE`)
	(cd os; $(ARADD) ../$@ `cat DONE`)
	(cd posix; $(ARADD) ../$@ `cat DONE`)
	RanLibrary($@)

all:: libkrb5.a

Krb5InstallLibrary(krb5,$(KRB5_LIBDIR))

# SharedLibraryTarget(kdb5,-L$(KRB5_LIBDIR) -Lshared $(LDLOCATIONS) -lkrb5 -l$(DESLIB) $(ISODELIB) -lcom_err)
/* SharedLibraryTarget(des425,-L$(KRB5_LIBDIR) -Lshared $(LDLOCATIONS) -l$(DESLIB)) */
