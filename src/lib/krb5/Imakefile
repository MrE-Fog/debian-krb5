#	$Source$
#	$Author$
#	$Id$
#
#  Copyright 1990,1991 by the Massachusetts Institute of Technology.
#  All Rights Reserved.
# 
# Export of this software from the United States of America is assumed
#   to require a specific license from the United States Government.
#   It is the responsibility of any person or organization contemplating
#   export to obtain such a license before exporting.
# 
# WITHIN THAT CONSTRAINT, permission to use, copy, modify, and
# distribute this software and its documentation for any purpose and
# without fee is hereby granted, provided that the above copyright
# notice appear in all copies and that both that copyright notice and
# this permission notice appear in supporting documentation, and that
# the name of M.I.T. not be used in advertising or publicity pertaining
# to distribution of the software without specific, written prior
# permission.  M.I.T. makes no representations about the suitability of
# this software for any purpose.  It is provided "as is" without express
# or implied warranty.
# 
# 
#define IHaveSubdirs
#define PassCDebugFlags
NormalLibraryObjectRule()

SUBDIRS1 = error_tables
SUBDIRS2 = ccache keytab krb rcache free os kdb des \
	des425 crc-32 krb425 rsa-md4 gssapi
SUBDIRS = $(SUBDIRS1) asn.1 $(SUBDIRS2)

#ifdef HasVfprintf
VPOBJS=
VPSRCS=
#else
VPOBJS=vfprintf.o vsprintf.o
VPSRCS=vfprintf.c vsprintf.c
#endif
#ifdef HasVsyslog
VSOBJS=
VSSRCS=
#else
VSOBJS=syslog.o
VSSRCS=syslog.c
#endif
#ifdef HasStrdup
STOBJS=
STSRCS=
#else
STOBJS=strdup.o
STSRCS=strdup.c
#endif

INCLUDES=$(STDC_TOP_INCLUDES)

OBJS =	\
	cryptoconf.o \
	perror.o \
	$(VSOBJS) $(VPOBJS) $(STOBJS)

SRCS =	\
	cryptoconf.c \
	perror.c \
	$(VSSRCS) $(VPSRCS) $(STSRCS)

MakeSubdirs($(SUBDIRS))

/* This target will make all Makefiles except asn.1/Makefile. */
#undef MakefileSubdirs
#define MakefileSubdirs(dirs)						@@\
MakeMakeSubdirs($(SUBDIRS1) $(SUBDIRS2), Makefiles)			@@\
MakeNsubdirMakefiles()

Makefiles::
	$(MAKE) asn.1/Makefile TOP=../$(TOP) CURRENT_DIR=$(CURRENT_DIR)/asn.1

asn.1/Makefile::
	cd asn.1; set -e; \
	$(IMAKE_CMD) -DTOPDIR=$(TOP) -DCURDIR=$(CURRENT_DIR) -s Makefile.new; \
	sed 's/^@/	@/' Makefile.new > Makefile.newer && $(MV) Makefile.newer Makefile.new ;\
	$(MAKE) -f Makefile.new noop; \
	if [ -f Makefile ]; then \
		echo "$(RM) Makefile.bak; $(MV) Makefile Makefile.bak"; \
		$(RM) Makefile.bak; $(MV) Makefile Makefile.bak; \
	fi ; \
	$(MV) Makefile.new Makefile; \
	$(RM) Makefile.new Makefile.newer


AdditiveLibraryTarget(krb5,$(OBJS))

RanlibLibraryTarget(des5)

Krb5InstallLibrary(krb5,$(KRB5_LIBDIR))
Krb5InstallLibrary(des5,$(KRB5_LIBDIR))
