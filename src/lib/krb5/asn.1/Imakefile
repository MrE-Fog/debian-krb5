#	$Source$
#	$Author$
#	$Id$
#
#  Copyright 1990 by the Massachusetts Institute of Technology.
# 
#  For copying and distribution information, please see the file
#  <krb5/copyright.h>.
# 
PepyPosyRules()
NormalLibraryObjectRule()

SRCS= \
	$(TYPESSRCS)	\
	encode.c 	\
	decode.c	\
	adat2kadat.c	\
	addr2kaddr.c	\
	adr2kadr.c	\
	aprp2kaprp.c	\
	aprq2kaprq.c	\
	arep2karep.c	\
	auth2kauth.c	\
	cvt_flags.c	\
	ck2kck.c	\
	edat2kedat.c	\
	ekrp2kekrp.c	\
	enck2kkey.c	\
	err2kerr.c	\
	etpt2ketpt.c	\
	g2unix.c	\
	kadat2adat.c	\
	kaddr2addr.c	\
	kadr2adr.c	\
	kaprp2aprp.c	\
	kaprq2aprq.c	\
	karep2arep.c	\
	kasrp2kdcr.c	\
	kauth2auth.c	\
	kck2ck.c	\
	kdcr2kasrp.c	\
	kdcr2kkdcr.c	\
	kdcr2ktgsr.c	\
	kedat2edat.c	\
	kekrp2ekrp.c	\
	kerr2err.c	\
	ketpt2etpt.c	\
	kkdcr2kdcr.c	\
	kkey2enck.c	\
	klsrq2lsrq.c	\
	kprep2prep.c	\
	kprin2prin.c	\
	kpriv2priv.c	\
	ksafe2safe.c	\
	ktgrq2tgrq.c	\
	ktgsr2kdcr.c	\
	ktkt2tkt.c	\
	lsrq2klsrq.c	\
	prep2kprep.c	\
	prin2kprin.c	\
	priv2kpriv.c	\
	qbuf2data.c	\
	safe2ksafe.c	\
	tgrq2ktgrq.c	\
	tkt2ktkt.c	\
	u2gen.c

OBJS= \
	$(TYPESOBJS)	\
	encode.o	\
	decode.o	\
	adat2kadat.o	\
	addr2kaddr.o	\
	adr2kadr.o	\
	aprp2kaprp.o	\
	aprq2kaprq.o	\
	arep2karep.o	\
	auth2kauth.o	\
	cvt_flags.o	\
	ck2kck.o	\
	edat2kedat.o	\
	ekrp2kekrp.o	\
	enck2kkey.o	\
	err2kerr.o	\
	etpt2ketpt.o	\
	g2unix.o	\
	kadat2adat.o	\
	kaddr2addr.o	\
	kadr2adr.o	\
	kaprp2aprp.o	\
	kaprq2aprq.o	\
	karep2arep.o	\
	kasrp2kdcr.o	\
	kauth2auth.o	\
	kck2ck.o	\
	kdcr2kasrp.o	\
	kdcr2kkdcr.o	\
	kdcr2ktgsr.o	\
	kedat2edat.o	\
	kekrp2ekrp.o	\
	kerr2err.o	\
	ketpt2etpt.o	\
	kkdcr2kdcr.o	\
	kkey2enck.o	\
	klsrq2lsrq.o	\
	kprep2prep.o	\
	kprin2prin.o	\
	kpriv2priv.o	\
	ksafe2safe.o	\
	ktgrq2tgrq.o	\
	ktgsr2kdcr.o	\
	ktkt2tkt.o	\
	lsrq2klsrq.o	\
	prep2kprep.o	\
	prin2kprin.o	\
	priv2kpriv.o	\
	qbuf2data.o	\
	safe2ksafe.o	\
	tgrq2ktgrq.o	\
	tkt2ktkt.o	\
	u2gen.o

#if HavePerl
#ifdef TypesObjs
#include "KRB5-oflist"
#include "KRB5-cflist"
#endif

all:: KRB5-oflist Makefile
#else /* no perl */
TYPESOBJS= KRB5-types.o
TYPESSRCS= KRB5-types.c
#endif

OtherdirLibraryTarget($(TOP)/lib,krb5,$(OBJS))

#if HavePerl
#define IHaveSpecialMakefileTarget

ImakeDependency(Makefile)

Makefile:: KRB5-oflist Imakefile
	$(IMAKE_CMD) -DTypesObjs -DTOPDIR=$(TOP) -DCURDIR=$(CURRENT_DIR)   -s Makefile.new
	$(MAKE) -f Makefile.new noop
	-@if [ -f Makefile ]; then \
		echo "$(RM) Makefile.bak; $(MV) Makefile Makefile.bak"; \
		$(RM) Makefile.bak; $(MV) Makefile Makefile.bak; \
	fi
	$(MV) Makefile.new Makefile

noop::

KRB5-pt0.c KRB5-cflist KRB5-oflist:	KRB5-types.c process.perl
	$(PERL) process.perl KRB5-types.c KRB5-pt KRB5-cflist KRB5-oflist
#endif

KRB5-types.c: KRB5-types.py

KRB5-types.py:	KRB5-asn.py
	$(POSY) $(POFLAGS) -o $@ KRB5-asn.py

clean::
	$(RM) KRB5-types.c KRB5.ph KRB5-types.py KRB5-types.h KRB5-pt*.c KRB5-oflist
