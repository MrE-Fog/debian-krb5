CFLAGS = $(CCOPTS) $(DEFS) -I$(srcdir)/crc32 -I$(srcdir)/des -I$(srcdir)/md4 \
	-I$(srcdir)/md5
LDFLAGS = -g

##DOSBUILDTOP = ..\..
##DOSLIBNAME=crypto.lib
##DOS!include $(BUILDTOP)\config\windows.in

TST=if test -n "`cat DONE`" ; then

OBJS=	cryptoconf.$(OBJEXT) \
	des_crc.$(OBJEXT) \
	des_md5.$(OBJEXT) \
	raw_des.$(OBJEXT)

SRCS=	$(srcdir)/cryptoconf.c \
	$(srcdir)/des_crc.c \
	$(srcdir)/des_md5.c \
	$(srcdir)/raw_des.c 

all:: all-$(WHAT)

all-unix::

all-windows:: $(OBJS)

libcrypto.a: des/DONE md4/DONE md5/DONE crc32/DONE os/DONE $(OBJS)
	(cd des; $(TST) $(ARADD) ../$@ `cat DONE` ; fi)
	(cd crc32; $(TST) $(ARADD) ../$@ `cat DONE` ; fi)
	(cd md4; $(TST) $(ARADD) ../$@ `cat DONE` ; fi)
	(cd md5; $(TST) $(ARADD) ../$@ `cat DONE` ; fi)
	(cd os; $(TST) $(ARADD) ../$@ `cat DONE` ; fi)
	$(ARADD) $@ $(OBJS)
	$(RANLIB) $@

libcrypto.lib:
	libdir crypto.lib

install:: libcrypto.a
	$(INSTALL_DATA) libcrypto.a $(DESTDIR)$(KRB5_LIBDIR)/libcrypto.a
	$(RANLIB) $(DESTDIR)$(KRB5_LIBDIR)/libcrypto.a

clean:: clean-$(WHAT)

clean-unix::
	$(RM) libcrypto.a

clean-windows::
	$(RM) crypto.lib crypto.bak

check:: check-$(WHAT)

check-unix::

all-windows::
	cd crc32
	@echo Making in crypto\crc32
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\des
	@echo Making in crypto\des
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\md4
	@echo Making in crypto\md4
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\md5
	@echo Making in crypto\md5
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\os
	@echo Making in crypto\os
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..

clean-windows::
	cd crc32
	@echo Making clean in crypto\crc32
	-$(MAKE) -$(MFLAGS) clean
	cd ..\des
	@echo Making clean in crypto\des
	-$(MAKE) -$(MFLAGS) clean
	cd ..\md4
	@echo Making clean in crypto\md4
	-$(MAKE) -$(MFLAGS) clean
	cd ..\md5
	@echo Making clean in crypto\md5
	-$(MAKE) -$(MFLAGS) clean
	cd ..\os
	@echo Making clean in crypto\os
	-$(MAKE) -$(MFLAGS) clean
	cd ..
	@echo Making clean locally

check-windows::
	cd crc32
	@echo Making check in crypto\crc32
	-$(MAKE) -$(MFLAGS) check
	cd ..\des
	@echo Making check in crypto\des
	-$(MAKE) -$(MFLAGS) check
	cd ..\md4
	@echo Making check in crypto\md4
	-$(MAKE) -$(MFLAGS) check
	cd ..\md5
	@echo Making check in crypto\md5
	-$(MAKE) -$(MFLAGS) check
	cd ..\os
	@echo Making check in crypto\os
	-$(MAKE) -$(MFLAGS) check
	cd ..

