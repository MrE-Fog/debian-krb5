KRB4_LIB = @KRB4_LIB@ @KRB4_CRYPTO_LIB@
KDB4_LIB = @KDB4_LIB@
CFLAGS = $(CCOPTS) $(DEFS) $(LOCALINCLUDE)
LDFLAGS = -g

COMERRLIB=$(BUILDTOP)/util/et/libcom_err.a
SSLIB=$(BUILDTOP)/util/ss/libss.a
DBMLIB=
KDBLIB=-lkdb5 
DEPKDBLIB=$(TOPLIBD)/libkdb5.a 

all::

KLIB = -lkrb5 $(KRB4_LIB) -lcrypto $(SSLIB) $(COMERRLIB) $(DBMLIB)
DEPKLIB = $(TOPLIBD)/libkrb5.a $(TOPLIBD)/libcrypto.a $(SSLIB) $(COMERRLIB) $(DBMLIB)

DEPLIBS = $(DEPKDBLIB) $(DEPKLIB)
LOCAL_LIBRARIES = $(KDBLIB) $(KDB4_LIB) $(KLIB)
LOCALINCLUDE=-I$(SRCTOP)/include/kerberosIV -I$(BUILDTOP)/include/kerberosIV

OBJS= kdb5_edit.o \
	kdb5_ed_ct.o \
	util.o \
	dump.o \
	dumpv4.o \
	ss_wrapper.o \
	getdate.o \
	$(LIBOBJS)

SRCS= $(srcdir)/kdb5_edit.c \
	$(srcdir)/kdb5_ed_ct.c \
	$(srcdir)/util.c \
	$(srcdir)/dump.c \
	$(srcdir)/ss_wrapper.c \
	$(srcdir)/dumpv4.c \
	$(srcdir)/getdate.c

all:: kdb5_edit

kdb5_edit: kdb5_edit.o $(DEPLIBS) $(OBJS)
	$(LD) $(LDFLAGS) $(LDARGS) -o kdb5_edit $(OBJS) $(LOCAL_LIBRARIES) $(LIBS)

getdate.c getdate.h: getdate.y
	$(RM) getdate.c getdate.h y.tab.*
	$(YACC) -d $(srcdir)/getdate.y
	$(MV) y.tab.c getdate.c
	$(MV) y.tab.h getdate.h

install::
	$(INSTALL_PROGRAM) kdb5_edit ${DESTDIR}$(ADMIN_BINDIR)/kdb5_edit
	$(INSTALL_DATA) $(srcdir)/kdb5_edit.M ${DESTDIR}$(ADMIN_MANDIR)/kdb5_edit.8

# needed until we run makedepend
kdb5_ed_ct.c: kdb5_ed_ct.ct

kdb5_ed_ct.o: kdb5_ed_ct.c

clean::
	$(RM) kdb5_ed_ct.c

depend:: kdb5_ed_ct.c

clean::
	$(RM) kdb5_edit getdate getdate.c getdate.h y.tab.c y.tab.h

# testing rule for building getdate
getdate: getdate.c
	$(CC) -o getdate $(CFLAGS) -DTEST getdate.c
