thisconfigdir=.
myfulldir=krb524
mydir=.
BUILDTOP=$(REL)$(U)
# Copyright 1994 by OpenVision Technologies, Inc.
# 
# Permission to use, copy, modify, distribute, and sell this software
# and its documentation for any purpose is hereby granted without fee,
# provided that the above copyright notice appears in all copies and
# that both that copyright notice and this permission notice appear in
# supporting documentation, and that the name of OpenVision not be used
# in advertising or publicity pertaining to distribution of the software
# without specific, written prior permission. OpenVision makes no
# representations about the suitability of this software for any
# purpose.  It is provided "as is" without express or implied warranty.
# 
# OPENVISION DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,
# INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO
# EVENT SHALL OPENVISION BE LIABLE FOR ANY SPECIAL, INDIRECT OR
# CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF
# USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
# OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
# PERFORMANCE OF THIS SOFTWARE.
# 

##WIN32##!if 0
LIB=krb524
##WIN32##!endif
LIBMAJOR=1
LIBMINOR=0
RELDIR=../krb524
STOBJLISTS=OBJS.ST

DEFINES = -DUSE_MASTER
PROG_LIBPATH=-L$(TOPLIBD) $(KRB4_LIBPATH)
PROG_RPATH=$(KRB5_LIBDIR)
KRB524_DEPLIB	= libkrb524.a
KRB524_LIB	= libkrb524.a

##WIN32##!ifdef USE_ALTERNATE_KRB4_INCLUDES
##WIN32##KRB4_INCLUDES=-I$(USE_ALTERNATE_KRB4_INCLUDES)
##WIN32##!endif

##WIN32##!ifdef USE_ALTERNATE_KRB4_LIB
##WIN32##K4LIB=$(USE_ALTERNATE_KRB4_LIB)
##WIN32##!endif

K524LIB = $(OUTPRE)krb524.lib
K524DEP = $(K524LIB)
K524DEF = krb524.def
WINLIBS = kernel32.lib wsock32.lib user32.lib shell32.lib oldnames.lib \
	version.lib advapi32.lib gdi32.lib

LOCALINCLUDES= $(KRB4_INCLUDES) -I. -I$(srcdir)

# Library sources
SRCS	= \
	$(srcdir)/conv_creds.c \
	$(srcdir)/conv_princ.c \
	$(srcdir)/cnv_tkt_skey.c \
	$(srcdir)/encode.c \
	$(srcdir)/misc.c \
	$(srcdir)/globals.c \
	$(srcdir)/sendmsg.c \
	$(srcdir)/krb524_err.et \
	$(srcdir)/libinit.c

STLIBOBJS = \
	$(OUTPRE)conv_creds.$(OBJEXT) \
	$(OUTPRE)conv_princ.$(OBJEXT) \
	$(OUTPRE)cnv_tkt_skey.$(OBJEXT) \
	$(OUTPRE)encode.$(OBJEXT) \
	$(OUTPRE)misc.$(OBJEXT) \
	$(OUTPRE)globals.$(OBJEXT) \
	$(OUTPRE)sendmsg.$(OBJEXT) \
	$(OUTPRE)krb524_err.$(OBJEXT) \
	$(OUTPRE)libinit.$(OBJEXT)

##WIN32##!ifdef KRB524_STATIC_HACK
##WIN32##LPREFIX=..\lib
##WIN32##K5_GLUE=$(LPREFIX)\$(OUTPRE)k5_glue.obj
##WIN32##KLIBS = $(LPREFIX)\krb5\$(OUTPRE)krb5.lib \
##WIN32##	$(LPREFIX)\crypto\$(OUTPRE)crypto.lib \
##WIN32##	$(BUILDTOP)\util\profile\$(OUTPRE)profile.lib \
##WIN32##	$(LPREFIX)\des425\$(OUTPRE)des425.lib
##WIN32##KLIB=$(KLIBS) $(DNSLIBS) $(K5_GLUE) $(CLIB)
##WIN32##STLIBOBJS=$(STLIBOBJS:libinit=globals)
##WIN32##K524DEP=$(STLIBOBJS)
##WIN32##!endif

GENS	= krb524_err.c krb524_err.h

KRB524_HDR=$(BUILDTOP)$(S)include$(S)krb524.h

all-unix:: $(GENS) 
all-unix:: all-libs
all-unix:: includes

all-unix:: krb524d krb524test k524init

includes:: krb524.h krb524_err.h
	if cmp $(srcdir)/krb524.h \
	$(BUILDTOP)/include/krb524.h  >/dev/null 2>&1; then :; \
	else \
		(set -x; $(RM) $(BUILDTOP)/include/krb524.h; \
		 $(CP) $(srcdir)/krb524.h \
			$(BUILDTOP)/include/krb524.h) ; \
	fi
	if cmp krb524_err.h \
	$(BUILDTOP)/include/krb524_err.h  >/dev/null 2>&1; then :; \
	else \
		(set -x; $(RM) $(BUILDTOP)/include/krb524_err.h; \
		 $(CP) krb524_err.h \
			$(BUILDTOP)/include/krb524_err.h) ; \
	fi

../include/krb524_err.h: includes

all-windows:: $(KRB524_HDR) $(K524LIB) $(OUTPRE)k524init.exe

krb524test: libkrb524.a test.o $(KRB524_DEPLIB) $(KRB4COMPAT_DEPLIBS)
	$(CC_LINK) -o krb524test test.o $(KRB524_LIB) $(KRB4COMPAT_LIBS)

krb524d: krb524d.o $(KADMSRV_DEPLIBS) $(KRB524_DEPLIB) $(KRB4COMPAT_DEPLIBS)
	$(CC_LINK) -o krb524d krb524d.o $(KADMSRV_LIBS) $(KRB524_LIB) $(KRB4COMPAT_LIBS)

k524init: k524init.o  $(KRB524_DEPLIB) $(KRB4COMPAT_DEPLIBS)
	$(CC_LINK) -o k524init k524init.o $(KRB524_LIB) $(KRB4COMPAT_LIBS)

$(K524LIB): $(STLIBOBJS) $(K4LIB) $(KLIB)
	link $(DLL_LINKOPTS) -def:$(K524DEF) -out:$*.dll $** $(WINLIBS)

$(OUTPRE)k524init.exe: $(OUTPRE)k524init.$(OBJEXT) $(K524DEP) $(KLIB) $(K4LIB) $(CLIB) $(BUILDTOP)\util\windows\$(OUTPRE)getopt.lib
	link $(EXE_LINKOPTS) -out:$@ $** $(WINLIBS)

install-unix:: install-libs
	$(INSTALL_PROGRAM) krb524d $(DESTDIR)$(SERVER_BINDIR)/krb524d
	$(INSTALL_PROGRAM) k524init $(DESTDIR)$(CLIENT_BINDIR)/krb524init

clean-unix:: clean-libs clean-libobjs
	$(RM) $(OBJS) $(GENS) core *~ *.bak #*
	$(RM) krb524test krb524d k524init test.o krb524d.o k524init.o
	$(RM) $(BUILDTOP)/include/krb524.h $(BUILDTOP)/include/krb524_err.h

$(KRB524_HDR): krb524.h
	$(CP) krb524.h $@
# +++ Dependency line eater +++
# 
# Makefile dependencies follow.  This must be the last section in
# the Makefile.in file
#
conv_creds.o: conv_creds.c $(BUILDTOP)/include/krb5.h \
  $(BUILDTOP)/include/profile.h $(BUILDTOP)/include/com_err.h \
  $(SRCTOP)/include/kerberosIV/krb.h $(SRCTOP)/include/kerberosIV/des.h \
  $(SRCTOP)/include/port-sockets.h krb524.h $(BUILDTOP)/include/krb524_err.h
conv_princ.o: conv_princ.c $(BUILDTOP)/include/krb5.h \
  $(BUILDTOP)/include/profile.h $(BUILDTOP)/include/com_err.h \
  $(SRCTOP)/include/kerberosIV/krb.h $(SRCTOP)/include/kerberosIV/des.h \
  $(SRCTOP)/include/port-sockets.h krb524.h $(BUILDTOP)/include/krb524_err.h
cnv_tkt_skey.o: cnv_tkt_skey.c $(SRCTOP)/include/k5-int.h \
  $(BUILDTOP)/include/krb5/osconf.h $(BUILDTOP)/include/krb5/autoconf.h \
  $(BUILDTOP)/include/krb5.h $(BUILDTOP)/include/profile.h \
  $(BUILDTOP)/include/com_err.h $(SRCTOP)/include/krb5/kdb.h \
  $(SRCTOP)/include/kerberosIV/krb.h $(SRCTOP)/include/kerberosIV/des.h \
  $(SRCTOP)/include/port-sockets.h krb524.h $(BUILDTOP)/include/krb524_err.h
encode.o: encode.c $(BUILDTOP)/include/krb5.h $(BUILDTOP)/include/profile.h \
  $(BUILDTOP)/include/com_err.h $(SRCTOP)/include/kerberosIV/krb.h \
  $(SRCTOP)/include/kerberosIV/des.h $(SRCTOP)/include/port-sockets.h \
  krb524.h $(BUILDTOP)/include/krb524_err.h
misc.o: misc.c $(BUILDTOP)/include/krb5.h $(BUILDTOP)/include/profile.h \
  $(BUILDTOP)/include/com_err.h $(SRCTOP)/include/kerberosIV/krb.h \
  $(SRCTOP)/include/kerberosIV/des.h $(SRCTOP)/include/port-sockets.h \
  krb524.h $(BUILDTOP)/include/krb524_err.h
globals.o: globals.c
sendmsg.o: sendmsg.c $(SRCTOP)/include/k5-int.h $(BUILDTOP)/include/krb5/osconf.h \
  $(BUILDTOP)/include/krb5/autoconf.h $(BUILDTOP)/include/krb5.h \
  $(BUILDTOP)/include/profile.h $(BUILDTOP)/include/com_err.h \
  $(SRCTOP)/include/port-sockets.h $(SRCTOP)/include/socket-utils.h \
  $(SRCTOP)/include/krb5/kdb.h $(SRCTOP)/include/kerberosIV/krb.h \
  $(SRCTOP)/include/kerberosIV/des.h krb524.h $(BUILDTOP)/include/krb524_err.h
libinit.o: libinit.c

