The main functions deal with the nitty-gritty details: verifying
tickets, creating authenticators, and the like.

\begin{funcdecl}{krb5_encode_kdc_rep}{krb5_error_code}{\funcin}
\funcarg{krb5_msgtype}{type}
\funcarg{krb5_enc_kdc_rep_part *}{encpart}
\funcarg{krb5_keyblock *}{client_key}
\funcinout
\funcarg{krb5_kdc_rep *}{dec_rep}
\funcout
\funcarg{krb5_data *}{enc_rep}
\end{funcdecl}

Takes KDC rep parts in \funcparam{*rep} and \funcparam{*encpart}, and
formats it into \funcparam{*enc_rep}, using message type \funcparam{type}
and encryption key \funcparam{client_key} and encryption type
\funcparam{dec_rep{\ptsto}etype}.

\funcparam{enc_rep{\ptsto}data} will point to  allocated storage upon
non-error return; the caller should free it when finished.

Returns system errors.

\begin{funcdecl}{krb5_decode_kdc_rep}{krb5_error_code}{\funcin}
\funcarg{krb5_data *}{enc_rep}
\funcarg{krb5_keyblock *}{key}
\funcarg{krb5_enctype}{etype}
\funcout
\funcarg{krb5_kdc_rep **}{dec_rep}
\end{funcdecl}

Takes a KDC_REP message and decrypts encrypted part using
\funcparam{etype} and \funcparam{*key}, putting result in \funcparam{*dec_rep}.
The pointers in \funcparam{dec_rep}
are all set to allocated storage which should be freed by the caller
when finished with the response (by using \funcname{krb5_free_kdc_rep}).


If the response isn't a KDC_REP (tgs or as), it returns an error from
the decoding routines (usually ISODE_50_LOCAL_ERR_BADDECODE).

Returns errors from encryption routines, system errors.

\begin{funcdecl}{krb5_kdc_rep_decrypt_proc}{krb5_error_code}{\funcin}
\funcarg{krb5_keyblock *}{key}
\funcarg{krb5_pointer}{decryptarg}
\funcinout
\funcarg{krb5_kdc_rep *}{dec_rep}
\end{funcdecl}

Decrypt the encrypted portion of \funcparam{dec_rep}, using the
encryption key \funcparam{key}.  \funcparam{decryptarg} is ignored.

The result is in allocated storage pointed to by
\funcparam{dec_rep{\ptsto}enc_part2}, unless some error occurs.

This function is suitable for use as the \funcparam{decrypt_proc}
argument to \funcname{krb5_get_in_tkt}.

\begin{funcdecl}{krb5_encrypt_tkt_part}{krb5_error_code}{ \funcin}
\funcarg{krb5_keyblock *}{srv_key}
\funcinout
\funcarg{krb5_ticket *}{dec_ticket}
\end{funcdecl}

Takes unencrypted \funcparam{dec_ticket} and
\funcparam{dec_ticket{\ptsto}enc_part2}, encrypts with
\funcparam{dec_ticket{\ptsto}etype}
using \funcparam{srv_key}, and places result in
\funcparam{dec_ticket{\ptsto}enc_part}.
The string \funcparam{dec_ticket{\ptsto}enc_part} will be allocated
before formatting.

Returns errors from encryption routines, system errors

\funcparam{enc_part{\ptsto}data} is allocated and filled in with
encrypted stuff.

\begin{funcdecl}{krb5_decrypt_tkt_part}{krb5_error_code}{\funcin}
\funcarg{krb5_keyblock *}{srv_key}
\funcinout
\funcarg{krb5_ticket *}{dec_ticket}
\end{funcdecl}

Takes encrypted \funcparam{dec_ticket{\ptsto}enc_part}, encrypts with
\funcparam{dec_ticket{\ptsto}etype}
using \funcparam{srv_key}, and places result in
\funcparam{dec_ticket{\ptsto}enc_part2}.  The storage of
\funcparam{dec_ticket{\ptsto}enc_part2} will be allocated before return.

Returns errors from encryption routines, system errors

\begin{funcdecl}{krb5_send_tgs}{krb5_error_code}{\funcin}
\funcarg{krb5_flags}{options}
\funcarg{krb5_ticket_times *}{timestruct}
\funcarg{krb5_enctype}{etype}
\funcarg{krb5_cksumtype}{sumtype}
\funcarg{krb5_principal}{sname}
\funcarg{krb5_address **}{addrs}
\funcarg{krb5_authdata **}{authorization_data}
\funcarg{krb5_data *}{second_ticket}
\funcinout
\funcarg{krb5_creds *}{usecred}
\funcout
\funcarg{krb5_response *}{rep}
\end{funcdecl}

Sends a request to the TGS and waits for a response.
\funcparam{options} is used for the options in the KRB_TGS_REQ.
\funcparam{timestruct} values are used for from, till, and rtime in the
KRB_TGS_REQ.
\funcparam{etype} is used for etype in the KRB_TGS_REQ.
\funcparam{sumtype} is used for the checksum in the AP_REQ in the KRB_TGS_REQ.
\funcparam{sname} is used for sname in the KRB_TGS_REQ.
\funcparam{addrs}, if non-NULL, is used for addresses in the KRB_TGS_REQ.
\funcparam{authorization_dat}, if non-NULL, is used for authorization_dat in the KRB_TGS_REQ.
\funcparam{second_ticket}, if required by options, is used for the 2nd
ticket in the KRB_TGS_REQ.
\funcparam{usecred} is used for the ticket and session key in the KRB_AP_REQ header in the KRB_TGS_REQ.

The KDC realm is extracted from \funcparam{usecred{\ptsto}server}'s realm.

The response is placed into \funcparam{*rep}.
\funcparam{rep{\ptsto}response.data} is set to point at allocated storage
which should be freed by the caller when finished.

Returns system errors.

\begin{funcdecl}{krb5_get_cred_from_kdc}{krb5_error_code}{\funcin}
\funcarg{krb5_ccache}{ccache}
\funcinout
\funcarg{krb5_creds *}{creds}
\funcout			
\funcparam{krb5_creds ***}{tgts }
\end{funcdecl}

Retrieve credentials for principal \funcparam{creds{\ptsto}client},
server \funcparam{creds{\ptsto}server},
ticket flags \funcparam{creds{\ptsto}ticket_flags}, possibly
\funcparam{creds{\ptsto}second_ticket} if needed by the ticket flags.

\funcparam{ccache} is used to fetch initial TGT's to start the authentication
path to the server.

Credentials are requested from the KDC for the server's realm.  Any
TGT credentials obtained in the process of contacting the KDC are
returned in an array of credentials; \funcparam{tgts} is filled in to
point to an array of pointers to credential structures (if no TGT's were
used, the pointer is zeroed).  TGT's may be returned even if no useful
end ticket was obtained.

The returned credentials are NOT cached.

If credentials are obtained, \funcparam{creds} is filled in with the results;
\funcparam{creds{\ptsto}ticket} and
\funcparam{creds{\ptsto}keyblock{\ptsto}key} are set to allocated storage,
which should be freed by the caller when finished.

Returns errors, system errors.


\begin{funcdecl}{krb5_free_tgt_creds}{void}{\funcin}
\funcarg{krb5_creds **}{tgts}
\end{funcdecl}

Frees the TGT credentials \funcparam{tgts} returned by
\funcname{krb5_get_cred_from_kdc}.

\begin{funcdecl}{krb5_get_credentials}{krb5_error_code}{\funcin}
\funcarg{krb5_flags}{options}
\funcarg{krb5_ccache}{ccache}
\funcinout
\funcarg{krb5_creds *}{creds}
\end{funcdecl}

Attempts to use the credentials cache \funcparam{ccache} or a TGS
exchange to get an additional ticket for the client identified by
\funcparam{creds{\ptsto}client}, the server identified by
\funcparam{creds{\ptsto}server}, with options \funcparam{options},
expiration date specified in \funcparam{creds{\ptsto}times.endtime} (0
means as long as possible), session key type specified in
\funcparam{creds{\ptsto}keyblock.keytype} (if non-zero).

If \funcparam{options} specifies KRB5_GC_CACHED, \funcname{get_credentials}
will only search the credentials cache for a ticket.  If
\funcparam{options} specifies KRB5_GC_USER_USER, \funcname{get_credentials}
will set the KDC_OPT_ENC_TKT_IN_SKEY flag in the KDC request.
\funcparam{creds{\ptsto}second_ticket} must contain a ticket.

Any returned ticket and intermediate ticket-granting tickets are
stored in \funcparam{ccache}.

Returns errors from encryption routines, system errors.

\begin{funcdecl}{krb5_get_in_tkt}{krb5_error_code}{\funcin}
\funcarg{krb5_flags}{options}
\funcarg{krb5_address **}{addrs}
\funcarg{krb5_enctype}{etype}
\funcarg{krb5_keytype}{keytype}
\funcfuncarg{krb5_error_code}{(*key_proc)}
	\funcarg{krb5_keytype}{type}
	\funcarg{krb5_keyblock **}{key}
	\funcarg{krb5_pointer}{keyseed}
\funcendfuncarg
\funcarg{krb5_pointer}{keyseed}
\funcfuncarg{krb5_error_code}{(*decrypt_proc)}
	\funcarg{krb5_keyblock *}{key}
	\funcarg{krb5_pointer}{decryptarg}
	\funcarg{krb5_kdc_rep *}{dec_rep}
\funcendfuncarg
\funcarg{krb5_pointer}{decryptarg}
\funcinout
\funcarg{krb5_creds *}{creds}
\funcarg{krb5_ccache}{ccache}
\end{funcdecl}

All-purpose initial ticket routine, usually called via
\funcname{krb5_get_in_tkt_with_password} or
\funcname{krb5_get_in_tkt_with_skey}.

Attempts to get an initial ticket for \funcparam{creds{\ptsto}client} to use server
\funcparam{creds{\ptsto}server}, (realm is taken from
\funcparam{creds{\ptsto}client}), with options 
\funcparam{options}, requesting encryption type \funcparam{etype}, and using
\funcparam{creds{\ptsto}times.starttime},  \funcparam{creds{\ptsto}times.endtime},
\funcparam{creds{\ptsto}times.renew_till}
as from, till, and rtime.  \funcparam{creds{\ptsto}times.renew_till} is
ignored unless the RENEWABLE option is requested.

\funcparam{key_proc} is called to fill in the key to be used for decryption.
\funcparam{keyseed} is passed on to \funcparam{key_proc}.

\funcparam{decrypt_proc} is called to perform the decryption of the
response (the encrypted part is in \funcparam{dec_rep{\ptsto}enc_part}; the
decrypted part should be allocated and filled into
\funcparam{dec_rep{\ptsto}enc_part2}.
\funcparam{decryptarg} is passed on to \funcparam{decrypt_proc}.

If \funcparam{addrs} is non-NULL, it is used for the addresses
requested.  If it is null, the system standard addresses are used.

A succesful call will place the ticket in the credentials cache
\funcparam{ccache} and fill in \funcparam{creds} with the ticket
information used/returned.

Returns system errors, encryption errors.

\begin{funcdecl}{krb5_get_in_tkt_with_password}{krb5_error_code}{\funcin}
\funcarg{krb5_flags}{options}
\funcarg{krb5_address **}{addrs}
\funcarg{krb5_enctype}{etype}
\funcarg{krb5_keytype}{keytype}
\funcarg{char *}{password}
\funcarg{krb5_ccache}{ccache}
\funcinout
\funcarg{krb5_creds *}{creds}
\end{funcdecl}


Attempts to get an initial ticket for \funcparam{creds{\ptsto}client} to use server
\funcparam{creds{\ptsto}server}, (realm is taken from
\funcparam{creds{\ptsto}client}), with options 
\funcparam{options}, requesting encryption type \funcparam{etype}, and using
\funcparam{creds{\ptsto}times.starttime},
\funcparam{creds{\ptsto}times.endtime},
\funcparam{creds{\ptsto}times.renew_till}
as from, till, and rtime.  \funcparam{creds{\ptsto}times.renew_till} is
ignored unless the RENEWABLE option is requested.

If \funcparam{addrs} is non-NULL, it is used for the addresses
requested.  If it is null, the system standard addresses are used.

If \funcparam{password} is non-NULL, it is converted using the
cryptosystem entry point for a string conversion routine, seeded with
the client's principal name.  If \funcparam{password} is passed as NULL,
the password is read from the terminal, and then converted into a key.

A succesful call will place the ticket in the credentials cache
\funcparam{ccache}.

Returns system errors, encryption errors.

\begin{funcdecl}{krb5_get_in_tkt_with_skey}{krb5_error_code}{\funcin}
\funcarg{krb5_flags}{options}
\funcarg{krb5_address **}{addrs}
\funcarg{krb5_enctype}{etype}
\funcarg{krb5_keyblock *}{key}
\funcarg{krb5_ccache}{ccache}
\funcinout
\funcarg{krb5_creds *}{creds}
\end{funcdecl}
Similar to \funcname{krb5_get_in_tkt_with_password}.

Attempts to get an initial ticket for \funcparam{creds{\ptsto}client} to use server
\funcparam{creds{\ptsto}server}, (realm is taken from
\funcparam{creds{\ptsto}client}), with options \funcparam{options}, requesting
encryption type \funcparam{etype}, and using 
\funcparam{creds{\ptsto}times.starttime}, \funcparam{creds{\ptsto}times.endtime},
\funcparam{creds{\ptsto}times.renew_till} as from, till, and rtime.
\funcparam{creds{\ptsto}times.renew_till} is ignored unless the
RENEWABLE option is requested.

If \funcparam{addrs} is non-NULL, it is used for the addresses
requested.  If it is null, the system standard addresses are used.

If \funcparam{keyblock} is NULL, an appropriate key for
\funcparam{creds{\ptsto}client} is retrieved from the system key store (e.g.
\filename{/etc/v5srvtab}).  If \funcparam{keyblock} is non-NULL, it is
used as the decryption key.

A succesful call will place the ticket in the credentials cache
\funcparam{ccache}.

Returns system errors, encryption errors.

\begin{funcdecl}{krb5_mk_req}{krb5_error_code}{\funcin}
\funcarg{krb5_principal}{server}
\funcarg{krb5_flags}{ap_req_options}
\funcarg{krb5_checksum *}{checksum}
\funcarg{krb5_ccache}{ccache}
\funcout
\funcarg{krb5_data *}{outbuf}
\end{funcdecl}

Formats a KRB_AP_REQ message into \funcparam{outbuf}.

\funcparam{server} specifies the principal of the server to receive the
message; if credentials are not present in the credentials cache
\funcparam{ccache} for this server, the TGS request with default
parameters is used in an attempt to obtain such credentials, and they
are stored in \funcparam{ccache}.

\funcparam{ap_req_options} specifies the KRB_AP_REQ options desired.

\funcparam{checksum} specifies the checksum to be used in the authenticator.

The \funcparam{outbuf} buffer storage is allocated, and should be freed
by the caller when finished.

Returns system errors.


\begin{funcdecl}{krb5_mk_req_extended}{krb5_error_code}{\funcin}
\funcarg{krb5_flags}{ap_req_options}
\funcarg{krb5_checksum *}{checksum}
\funcarg{krb5_flags}{kdc_options}
\funcarg{krb5_int32}{sequence}
\funcarg{krb5_keyblock **}{newkey}
\funcarg{krb5_ccache}{ccache}
\funcinout
\funcarg{krb5_creds *}{creds}
\funcarg{krb5_authenticator *}{authentp}
\funcout
\funcarg{krb5_data *}{outbuf}
\end{funcdecl}

Formats a KRB_AP_REQ message into \funcparam{outbuf}, with more complete
options than \funcname{krb5_mk_req}.

\funcparam{outbuf}, \funcparam{ap_req_options}, \funcparam{checksum},
and \funcparam{ccache} are used in the same fashion as for
\funcname{krb5_mk_req}.

\funcparam{creds} is used to supply the credentials (ticket and session
key) needed to form the request.

If \funcparam{creds{\ptsto}ticket} has no data (length == 0), then a
ticket is obtained from either \funcparam{ccache} or the TGS, passing
\funcparam{creds} to \funcname{krb5_get_credentials}. 
\funcparam{kdc_options} specifies the options requested for the ticket
to be used. If a ticket with appropriate flags is not found in
\funcparam{ccache}, then these options are passed on in a request to an
appropriate KDC.

\funcparam{ap_req_options} specifies the KRB_AP_REQ options desired.

\funcparam{sequence}, if non-zero, specifies the initial sequence number
which the caller will use for KRB_SAFE or KRB_PRIV messages.

\funcparam{newkey}, if non-NULL, will be filled in upon return with a 
sub-session key that the caller can use to protect future KRB_SAFE or
KRB_PRIV messages.  When the caller is finished with the key, it should
be freed with \funcname{krb5_free_keyblock}.

If \funcparam{ap_req_options} specifies AP_OPTS_USE_SESSION_KEY, then
\funcparam{creds{\ptsto}ticket} must contain the appropriate
ENC-TKT-IN-SKEY ticket.

\funcparam{checksum} specifies the checksum to be used in the
authenticator.

If \funcparam{authentp} is non-NULL, \funcname{krb5_mk_req_extended}
will store
a copy of authenticator there, with the principal and checksum fields
nulled out.  (This is to prevent pointer sharing problems; the caller
shouldn't need these fields anyway, since the caller supplied them.)

The \funcparam{outbuf} buffer storage is allocated, and should be freed
by the caller when finished.

On an error return, the credentials pointed to by \funcparam{creds}
might have been augmented with additional fields from the obtained
credentials; the entire credentials should be released by calling
\funcname{krb5_free_creds}.

Returns system errors.

\begin{funcdecl}{krb5_generate_subkey}{krb5_error_code}{\funcin}
\funcarg{const krb5_keyblock *}{key}
\funcout
\funcarg{krb5_keyblock **}{subkey}
\end{funcdecl}

Generates a pseudo-random sub-session key using the encryption system's
random key functions, based on the input \funcparam{key}.

\funcparam{subkey} is filled in to point to the generated subkey, unless
an error is returned.  The returned key is allocated and should be freed
by the caller with \funcname{krb5_free_keyblock} when it is no longer
needed.

\begin{funcdecl}{krb5_rd_req_simple}{krb5_error_code}{\funcin}
\funcarg{const krb5_data *}{inbuf}
\funcarg{krb5_const_principal}{server}
\funcarg{const krb5_address *}{sender_addr}
\funcout
\funcarg{krb5_tkt_authent **}{authdat}
\end{funcdecl}

Parses a KRB_AP_REQ message, returning its contents.  Upon exiting,
\funcparam{*authdat} will be modified to point to allocated storage
containing the ticket and authenticator information.  The caller is
responsible for deallocating this space by using
\funcname{krb5_free_tkt_authent}.

\funcparam{server} specifies the expected server's name for the ticket.

\funcparam{sender_addr} specifies the address(es) expected to be present
in the ticket.

A replay cache name derived from the first component of the service name
is used.

The default key store is consulted to find the service key.

\funcparam{authdat{\ptsto}ticket} and
\funcparam{authdat{\ptsto}authenticator} are set to allocated storage
structures; the caller should free them when finished.

Returns system errors, encryption errors, replay errors.


\begin{funcdecl}{krb5_rd_req}{krb5_error_code}{\funcin}
\funcarg{krb5_data *}{inbuf}
\funcarg{krb5_principal}{server}
\funcarg{krb5_address *}{sender_addr}
\funcarg{krb5_pointer}{fetchfrom}
\funcfuncarg{krb5_error_code}{(*keyproc)}
\funcarg{krb5_pointer}{keyprocarg}
\funcarg{krb5_principal}{principal}
\funcarg{krb5_kvno}{vno}
\funcarg{krb5_keyblock **}{key}
\funcendfuncarg
\funcarg{krb5_pointer}{keyprocarg}
\funcinout
\funcarg{krb5_rcache}{rcache}
\funcout
\funcarg{krb5_tkt_authent **}{authdat}
\end{funcdecl}

Parses a KRB_AP_REQ message, returning its contents.  Upon exiting,
\funcparam{*authdat} will be modified to point to allocated storage
containing the ticket and authenticator information.  The caller is
responsible for deallocating this space by using
\funcname{krb5_free_tkt_authent}.

\funcparam{server} specifies the expected server's name for the ticket.
If \funcparam{server} is NULL, then any server name will be accepted if
the appropriate key can be found, and the caller should verify that the
server principal matches some trust criterion.

\funcparam{sender_addr} specifies the address(es) expected to be present
in the ticket.

\funcparam{rcache} specifies a replay detection cache used to store
authenticators and server names.  If \funcparam{rcache} is NULL, then no
replay detection is performed.

\funcparam{keyproc} specifies a procedure to generate a decryption key for the
ticket.  If \funcparam{keyproc} is non-NULL, \funcparam{keyprocarg} is
passed to it, and the result used as a decryption key. If
\funcparam{keyproc} is NULL, then \funcparam{fetchfrom} is checked; if
it is non-NULL, it specifies a parameter name from which to retrieve the
decryption key.  If \funcparam{fetchfrom} is NULL, then the default key
store is consulted.

\funcparam{authdat{\ptsto}ticket} and
\funcparam{authdat{\ptsto}authenticator} are set to allocated storage
structures; the caller should free them when finished.

Returns system errors, encryption errors, replay errors.

\begin{funcdecl}{krb5_rd_req_decoded}{krb5_error_code}{\funcin}
\funcarg{krb5_ap_req *}{req}
\funcarg{krb5_principal}{server}
\funcarg{krb5_address *}{sender_addr}
\funcarg{krb5_pointer}{fetchfrom}
\funcfuncarg{krb5_error_code}{(*keyproc)}
\funcarg{krb5_pointer}{keyprocarg}
\funcarg{krb5_principal}{principal}
\funcarg{krb5_kvno}{vno}
\funcarg{krb5_keyblock **}{key}
\funcendfuncarg
\funcarg{krb5_pointer}{keyprocarg}
\funcarg{krb5_rcache}{rcache}
\funcout
\funcarg{krb5_tkt_authent **}{authdat}
\end{funcdecl}

Essentially the same as \funcname{krb5_rd_req}, but uses a decoded AP_REQ
as the input rather than an encoded input.

\begin{funcdecl}{krb5_mk_rep}{krb5_error_code}{\funcin}
\funcarg{const krb5_ap_rep_enc_part *}{repl}
\funcarg{const krb5_keyblock *}{kblock}
\funcout
\funcarg{krb5_data *}{outbuf}
\end{funcdecl}

Formats and encrypts an AP_REP message, using \funcparam{*repl} for the
encrypted part of the message.  The message is encrypted under the key
in \funcparam{*kblock}, then encoded and left in outbuf.

The output buffer storage is allocated, and should be freed by the
caller when finished.

Returns system errors.

\begin{funcdecl}{krb5_rd_rep}{krb5_error_code}{\funcin}
\funcarg{const krb5_data *}{inbuf}
\funcarg{const krb5_keyblock *}{kblock}
\funcout
\funcarg{krb5_ap_rep_enc_part **}{repl}
\end{funcdecl}

Parses and decrypts an AP_REP message from \funcparam{*inbuf}, filling in
\funcparam{*repl} with a pointer allocating storage containing the
values from the message.  The caller is responsible for freeing this
structure with \funcname{krb5_free_ap_rep_enc_part}.

The key in \funcparam{*kblock} is used to decrypt the message.

Returns system errors.

\begin{funcdecl}{krb5_mk_error}{krb5_error_code}{\funcin}
\funcarg{krb5_error *}{dec_err}
\funcout
\funcarg{krb5_data *}{enc_err}
\end{funcdecl}

Formats the error structure \funcparam{*dec_err} into an error buffer
\funcparam{*enc_err}.

The error buffer storage is allocated, and should be freed by the
caller when finished.

Returns system errors.

\begin{funcdecl}{krb5_rd_error}{krb5_error_code}{\funcin}
\funcarg{krb5_data *}{enc_errbuf}
\funcout
\funcarg{krb5_error **}{dec_error}
\end{funcdecl}

Parses an error message from \funcparam{enc_errbuf} and fills in 
\funcparam{*dec_error} with a pointer to allocated storage containing
the error message.  The caller is reponsible for free this structure by
using \funcname{krb5_free_error}.

Upon return \funcparam{dec_error{\ptsto}client},
\funcparam{dec_error{\ptsto}server}, and
\funcparam{dec_error{\ptsto}text}, if non-NULL, point to allocated
storage which the caller should free when finished.

Returns system errors.

\begin{funcdecl}{krb5_generate_seq_number}{krb5_error_code}{\funcin}
\funcarg{const krb5_keyblock *}{key}
\funcout
\funcarg{krb5_int32 *}{seqno}
\end{funcdecl}

Generates a pseudo-random sequence number suitable for use as an initial
sequence number for the KRB_SAFE and KRB_PRIV message processing
routines.

\funcparam{key} parameterizes the choice of the random sequence number,
which is filled into \funcparam{*seqno} upon return.

\begin{funcdecl}{krb5_sendauth}{krb5_error_code}
\funcin
\funcarg{krb5_pointer}{fd}
\funcarg{char *}{appl_version}
\funcarg{krb5_principal}{client}
\funcarg{krb5_principal}{server}
\funcarg{krb5_flags}{ap_req_options}
\funcarg{krb5_checksum *}{checksump}
\funcinout
\funcarg{krb5_creds *}{credsp}
\funcarg{krb5_ccache}{ccache}
\funcout
\funcarg{krb5_int32 *}{sequence}
\funcarg{krb5_keyblock **}{newkey}
\funcarg{krb5_error **}{error}
\funcarg{krb5_ap_rep_enc_part **}{rep_result}
\end{funcdecl}

\funcname{krb5_sendauth} provides a convenient means for client and
server programs to send authenticated messages to one another through
network connections.  \funcname{krb5_sendauth} sends an authenticated
ticket from the client program to the server program using the network
connection specified by \funcparam{fd}.  In the MIT Unix implementation,
\funcparam{fd} should be a pointer to a file descriptor describing the
network socket.  This can be changed in other implementations, however,
if the routines \funcname{krb5_read_message},
\funcname{krb5_write_message}, \funcname{krb5_net_read}, and
\funcname{krb5_net_write} are changed.\footnote{Well, this isn't quite
true; the interfaces for \funcname{krb5_net_read} and
\funcname{krb5_net_write} currently take an integer instead of a pointer
to an integer, but this will be fixed soon\ldots}

The paramter \funcparam{appl_version} is a string describing the
application protocol version which the client is expecting to use for
this exchange.  If the server is using a different application protocol,
an error will be returned.

The parameters \funcparam{client} and \funcparam{server} specify the
kerberos principals for the client and the server.  The
\funcparam{ap_req_options} parameters specifies the options which should
be passed to \funcname{krb5_mk_ap_req}.  If \funcparam{ap_req_options}
specifies AP_OPTS_MUTUAL_REQUIRED, then \funcname{krb5_sendauth} will
perform a mutual authentication exchange, and if \funcparam{rep_result}
is non-zero, it will be filled in with the result of the mutual
authentication exchange.

The \funcparam{checksump} paramter is optional; if it is non-zero, then the
checksum structure will be sent to the server as part of the
authenticated ticket exchange.

If \funcparam{credsp} is nonzero and contains a valid credentials then
the client credentials will be obtained from the structure pointed to by
\funcparam{credsp}.  If not, then \funcparam{ccache} must contain a
credentials cache handle where the required credentials can be fetched.

If non-zero, \funcparam{sequence} is filled in with the sequence number
which the client should use for sending or receiving messages generated
using \funcname{krb5_mk_safe} and \funcname{krb5_mk_priv}.  The sequence
number for the server can be determined by looking in the structured
filled in by \funcparam{rep_result}, if mutual authentication was used.
(If mutual authentication was not used, there is no way to negotiate a
sequence number for the server.)

If an error occurs during the authenticated ticket exchange, the error
packet that was sent from the server will be filled into
\funcparam{error}, if \funcparam{error} is non-zero.

\begin{funcdecl}{krb5_recvauth}{krb5_error_code}
\funcin
\funcarg{krb5_pointer}{fd}
\funcarg{char *}{appl_version}
\funcarg{krb5_principal}{server}
\funcarg{krb5_address *}{sender_addr}
\funcarg{krb5_pointer}{fetchfrom}
\funcarg{krb5_rdreq_key_proc}{keyproc}
\funcarg{krb5_pointer}{keyprocarg}
\funcarg{char *}{rc_type}
\funcout
\funcarg{krb5_int32 *}{sequence}
\funcarg{krb5_principal *}{client}
\funcarg{krb5_ticket **}{krb5_ticket}
\funcarg{krb5_authenticator **}{authent}
\end{funcdecl}

\funcname{krb5_sendauth} provides a convenient means for client and
server programs to send authenticated messages to one another through
network connections.  \funcname{krb5_recvauth} receives the ticket from
sent by \funcparam{krb5_sendauth}, and, if requested by the client, will
perform mutual authentication to prove to the client that the server
represented by \funcparam{krb5_recvauth} is legitimate.

\funcparam{fd} is a pointer to the network connection.  As in
\funcname{krb5_sendauth}, \funcparam{fd} is a pointer to a file
descriptor in the MIT Unix implementation.

The parameter \funcparam{appl_version} is a string describing the
application protocol version which the server is expecting to use for
this exchange.  If the client is using a different application protocol,
an error will be returned and the authentication exchange will be
aborted.

The parameters \funcparam{fetchfrom}, \funcparam{keyproc}, and
\funcparam{keyprocarg} are used by \funcname{krb5_rd_req} to obtain the
server's private key.

\funcparam{rc_type} is a string which determins which type of replace
cache \funcname{krb5_recvauth} should use.  \funcname{krb5_recvauth}
uses a standard convention for determining the name of the replay cache
to be used.

All of the output paramters are optional and they are only filled in if
they are non-NULL.  \funcparam{sequence} is filled in with the
sequence number which the server should use (if desired) for sending or
receiving message using \funcname{krb5_mk_safe} and
\funcname{krb5_mk_priv}.   The client's sequence number is passed back
as part of the authenticator structure which is filled in if
\funcparam{authent} is nonzero.  

\funcparam{client} is filled in with the client principal which
initiated the authenticated connection.

\begin{funcdecl}{krb5_mk_safe}{krb5_error_code}{\funcin}
\funcarg{krb5_data *}{userdata}
\funcarg{krb5_cksumtype}{sumtype}
\funcarg{krb5_keyblock *}{key,}
\funcarg{krb5_fulladdr *}{sender_addr}
\funcarg{krb5_fulladdr *}{recv_addr}
\funcarg{krb5_int32}{seq_number}
\funcarg{krb5_int32}{safe_flags}
\funcarg{krb5_rcache}{rcache}
\funcout
\funcarg{krb5_data *}{outbuf}
\end{funcdecl}

Formats a KRB_SAFE message into \funcparam{outbuf}.

\funcparam{userdata} is formatted as the user data in the message.
\funcparam{sumtype} specifies the encryption type; \funcparam{key}
specifies the key which might be used to seed the checksum;
\funcparam{sender_addr} and \funcparam{recv_addr} specify the full
addresses (host and port) of the sender and receiver.  The host portion
of \funcparam{sender_addr} is used to form the addresses used in the
KRB_SAFE message.

\funcparam{safe_flags} selects whether sequence numbers or timestamps
should be used to identify the message.  If timestamps are to be used,
an entry describing the message will be entered in the replay cache
\funcparam{rcache} so that the caller may detect if this message is sent
back to him by an attacker.

The functions \funcname{krb5_gen_replay_name} and
\funcname{krb5_get_server_rcache} can be used to open a replay cache
appropriate to use as \funcparam{rcache}.

The \funcparam{outbuf} buffer storage is allocated, and should be freed by the
caller when finished.

Returns system errors.

\begin{funcdecl}{krb5_rd_safe}{krb5_error_code}{\funcin}
\funcarg{krb5_data *}{inbuf}
\funcarg{krb5_keyblock *}{key}
\funcarg{krb5_address *}{sender_addr}
\funcarg{krb5_address *}{recv_addr}
\funcarg{krb5_int32}{seq_number}
\funcarg{krb5_int32}{safe_flags}
\funcinout
\funcarg{krb5_rcache}{rcache}
\funcout
\funcarg{krb5_data *}{outbuf}
\end{funcdecl}

Parses a KRB_SAFE message from \funcparam{inbuf}, placing the
integrity-protected user data in \funcparam{*outbuf}.

\funcparam{key} specifies the key to be used for decryption of the message.
 
\funcparam{sender_addr} and \funcparam{recv_addr} specify the full
addresses (host and port) of the sender and receiver.

\funcparam{outbuf} points to allocated storage which the caller should
free when finished.

If \funcparam{safe_flags} indicates that sequence numbers are to be
used, \funcparam{seq_number} is used as the sequence number for the
message.  If this is not the case, a timestamp is inserted in the
message, and \funcparam{sender_addr} must be of type
\datatype{ADDRTYPE_ADDRPORT}, and the message is checked for replays
against the cache entries in \funcparam{rcache}.

The function \funcname{krb5_get_server_rcache} and the service-name
portion of the server principal name can be used to open a
replay cache appropriate to use as \funcparam{rcache}.

Returns system errors, integrity errors.

\begin{funcdecl}{krb5_mk_priv}{krb5_error_code}{\funcin}
\funcarg{krb5_data *}{userdata}
\funcarg{krb5_enctype}{etype}
\funcarg{krb5_keyblock *}{key}
\funcarg{krb5_address *}{sender_addr}
\funcarg{krb5_address *}{recv_addr}
\funcarg{krb5_int32}{seq_number}
\funcarg{krb5_int32}{priv_flags}
\funcarg{krb5_rcache}{rcache}
\funcinout
\funcarg{krb5_pointer}{i_vector}
\funcout
\funcarg{krb5_data *}{outbuf}
\end{funcdecl}

Formats a KRB_PRIV message into \funcparam{outbuf}.

\funcparam{userdata} is formatted as the user data in the message.
\funcparam{etype} specifies the encryption type; \funcparam{key}
specifies the key for the encryption; \funcparam{sender_addr} and
\funcparam{recv_addr} specify the addresses of the sender and
receiver.

\funcparam{i_vector} is used as an initialization vector for the
encryption, and if non-NULL its contents are replaced with the last
block of the encrypted data upon exit.

\funcparam{priv_flags} selects whether sequence numbers or timestamps
should be used to identify the message.  If timestamps are to be used,
an entry describing the message will be entered in the replay cache
\funcparam{rcache} so that the caller may detect if this message is sent
back to him by an attacker.

The functions \funcname{krb5_gen_replay_name} and
\funcname{krb5_get_server_rcache} can be used to open a replay cache
appropriate to use as \funcparam{rcache}.

The \funcparam{outbuf} buffer storage is allocated, and should be freed by the
caller when finished.

Returns system errors.

\begin{funcdecl}{krb5_rd_priv}{krb5_error_code}{\funcin}
\funcarg{krb5_data *}{inbuf}
\funcarg{krb5_keyblock *}{key}
\funcarg{krb5_address *}{sender_addr}
\funcarg{krb5_address *}{recv_addr}
\funcarg{krb5_int32}{seq_number}
\funcarg{krb5_int32}{priv_flags}
\funcinout
\funcarg{krb5_pointer}{i_vector}
\funcarg{krb5_rcache}{rcache}
\funcout
\funcarg{krb5_data *}{outbuf}
\end{funcdecl}

Parses a KRB_PRIV message from \funcparam{inbuf}, placing the confidential user
data in \funcparam{*outbuf}.

\funcparam{key} specifies the key to be used for decryption of the message.
 
\funcparam{sender_addr} and \funcparam{recv_addr} specify the addresses
of the sender and receiver.

\funcparam{outbuf} points to allocated storage which the caller should
free when finished.

\funcparam{i_vector} is used as an initialization vector for the
encryption, and if non-NULL its contents are replaced with the last
block of the encrypted data upon exit.

If \funcparam{priv_flags} indicates that sequence numbers are to be
used, \funcparam{seq_number} is used as the sequence number for the
message.  If this is not the case, a timestamp is inserted in the
message, and \funcparam{sender_addr} must be of type
\datatype{ADDRTYPE_ADDRPORT}, and the message is checked for replays
against the cache entries in \funcparam{rcache}.

The function \funcname{krb5_get_server_rcache} and the service-name
portion of the server principal name can be used to open a
replay cache appropriate to use as \funcparam{rcache}.

Returns system errors, integrity errors.

\begin{funcdecl}{krb5_parse_name}{krb5_error_code}{\funcin}
\funcarg{char *}{name}
\funcout
\funcarg{krb5_principal *}{principal}
\end{funcdecl}

Converts a single-string representation \funcparam{name} of the
principal name to the multi-part principal format used in the protocols.

\funcparam{*principal} will point to allocated storage which should be freed by
the caller (using \funcname{krb5_free_principal}) after use.

\funcname{krb5_parse_name} returns KRB5_PARSE_MALFORMED if the string is
 badly formatted, or ENOMEM if space for the return value can't be
allocated.

\begin{funcdecl}{krb5_unparse_name}{krb5_error_code}{\funcin}
\funcarg{krb5_principal}{principal}
\funcout
\funcarg{char **}{name}
\end{funcdecl}

Converts the multi-part principal name \funcparam{principal} from the
format used in the protocols to a single-string representation of the name.

\funcparam{*name} points to allocated storage and should be freed by the caller
when finished.

\funcname{krb5_unparse_name} returns KRB_PARSE_MALFORMED if the principal
does not contain at least 2 components, and system errors (ENOMEM if
unable to allocate memory).

\begin{funcdecl}{krb5_build_principal}{krb5_error_code}{\funcout}
\funcarg{krb5_principal *}{princ}
\funcin
\funcarg{int}{rlen}
\funcarg{const char *}{realm}
\funcarg{char}{*s1, *s2, ..., 0}
\end{funcdecl}
\begin{funcdecl}{krb5_build_principal_va}{krb5_error_code}{\funcout}
\funcarg{krb5_principal *}{princ}
\funcin
\funcarg{int}{rlen}
\funcarg{const char *}{realm}
\funcarg{va_list}{ap}
\end{funcdecl}

\funcname{krb5_build_principal} and \funcname{krb5_build_principal_va}
perform the same function; the former takes variadic arguments, while
the latter takes a pre-computed varargs pointer.

Both functions take a realm name \funcparam{realm}, realm name length
\funcparam{rlen}, and a list of null-terminated strings, and fill in a
pointer to a principal structure \funcparam{princ}, making it point to a
structure representing the named principal.
The last string must be followed in the argument list by a null pointer.


\begin{funcdecl}{krb5_build_principal_ext}{krb5_error_code}{\funcout}
\funcarg{krb5_principal *}{princ}
\funcin
\funcarg{int}{rlen}
\funcarg{const char *}{realm}
\funcarg{}{int len1, char *s1, int len2, char *s2, ..., 0}
\end{funcdecl}

\funcname{krb5_build_principal_ext} is similar to
\funcname{krb5_build_principal} but it takes its components as a list of
(length, contents) pairs rather than a list of null-terminated strings.
A length of zero indicates the end of the list.

\begin{funcdecl}{krb5_address_search}{krb5_boolean}{\funcin}
\funcarg{krb5_address *}{addr}
\funcarg{krb5_address **}{addrlist}
\end{funcdecl}

If \funcparam{addr} is listed in \funcparam{addrlist}, or
\funcparam{addrlist} is null, return TRUE.  If not listed, return FALSE.

\begin{funcdecl}{krb5_address_compare}{krb5_boolean}{\funcin}
\funcarg{krb5_address *}{addr1}
\funcarg{krb5_address *}{addr2}
\end{funcdecl}

If the two addresses are the same, return TRUE, else return FALSE.

\begin{funcdecl}{krb5_principal_compare}{krb5_boolean}{\funcin}
\funcarg{krb5_principal}{p1}
\funcarg{krb5_principal}{p2}
\end{funcdecl}

If the two principals are the same, return TRUE, else return FALSE.

\begin{funcdecl}{krb5_fulladdr_order}{int}{\funcin}
\funcarg{krb5_fulladdr *}{addr1}
\funcarg{krb5_fulladdr *}{addr2}
\end{funcdecl}

Return an ordering on the two full addresses:  0 if the same,
$< 0$ if first is less than 2nd, $> 0$ if first is greater than 2nd.

\begin{funcdecl}{krb5_address_order}{int}{\funcin}
\funcarg{const krb5_address *}{addr1}
\funcarg{const krb5_address *}{addr2}
\end{funcdecl}

Return an ordering on the two addresses:  0 if the same,
$< 0$ if first is less than 2nd, $> 0$ if first is greater than 2nd.

\begin{funcdecl}{krb5_copy_keyblock}{krb5_error_code}{\funcin}
\funcarg{krb5_keyblock *}{from}
\funcout
\funcarg{krb5_keyblock **}{to}
\end{funcdecl}

Copy a keyblock, filling in \funcparam{*to} to point to the newly
allocated copy, which should be freed with
\funcname{krb5_free_keyblock}. 

\begin{funcdecl}{krb5_copy_keyblock_contents}{krb5_error_code}{\funcin}
\funcarg{krb5_keyblock *}{from}
\funcout
\funcarg{krb5_keyblock *}{to}
\end{funcdecl}

Copy a keyblock from \funcparam{from} to \funcparam{to}, including
allocated storage.  The allocated storage in \funcparam{to} should be
freed by using {\bf free}(\funcparam{to->contents}).

\begin{funcdecl}{krb5_copy_creds}{krb5_error_code}{\funcin}
\funcarg{krb5_creds *}{incred}
\funcout
\funcarg{krb5_creds **}{outcred}
\end{funcdecl}

Copy a credentials structure, filling in \funcparam{*outcred} to point
to the newly allocated copy, which should be freed with
\funcname{krb5_free_creds}.

\begin{funcdecl}{krb5_copy_data}{krb5_error_code}{\funcin}
\funcarg{krb5_data *}{indata}
\funcout
\funcarg{krb5_data **}{outdata}
\end{funcdecl}

Copy a data strucutre, filling in \funcparam{*outdata} to point to the
newly allocated copy, which should be freed with \funcname{krb5_free_data}.

\begin{funcdecl}{krb5_copy_principal}{krb5_error_code}{\funcin}
\funcarg{krb5_principal}{inprinc}
\funcout
\funcarg{krb5_principal *}{outprinc}
\end{funcdecl}
Copy a principal structure, filling in \funcparam{*outprinc} to point to
the newly allocated copy, which should be freed with
\funcname{krb5_free_principal}.

\begin{funcdecl}{krb5_auth_to_rep}{krb5_error_code}{\funcin}
\funcarg{krb5_tkt_authent *}{auth}
\funcout
\funcarg{krb5_donot_replay *}{rep}
\end{funcdecl}
Extract the relevant parts of \funcparam{auth} and fill them into the
structure pointed to by \funcparam{rep}.  \funcparam{rep{\ptsto}client}
and \funcparam{rep{\ptsto}server} are set to allocated storage and
should be freed when \funcparam{*rep} is no longer needed.

\begin{funcdecl}{krb5_get_server_rcache}{krb5_error_code}{\funcin}
\funcarg{const krb5_data *}{piece}
\funcout
\funcarg{krb5_rcache *}{ret_rcache}
\end{funcdecl}
Generate a replay cache name, allocate space for its handle, and open
it.  \funcarg{piece} is used to distinguish this replay cache from
others currently in use on the system.
Upon successful return, \funcarg{ret_rcache} is filled in to contain a
handle to an open rcache, which should be closed with
\funcname{krb5_rc_close} and then freed with \funcname{xfree} when the
caller is finished using it.
